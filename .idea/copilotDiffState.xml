<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/chatbot_diseo/presentation/navigation/AppNavGraph.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/chatbot_diseo/presentation/navigation/AppNavGraph.kt" />
              <option name="originalContent" value="package com.example.chatbot_diseo.presentation.navigation&#10;&#10;import android.widget.Toast&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.navigation.NavHostController&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.navArgument&#10;import androidx.navigation.NavType&#10;import com.example.chatbot_diseo.data.api.TokenHolder&#10;import com.example.chatbot_diseo.presentation.admin.page.AdminPanelScreen&#10;import com.example.chatbot_diseo.presentation.auth.ForgotPasswordScreen&#10;import com.example.chatbot_diseo.presentation.auth.LoginScreen&#10;import com.example.chatbot_diseo.presentation.ayuda.AyudaScreen&#10;import com.example.chatbot_diseo.presentation.calendario.Pantalla_Calendario&#10;import com.example.chatbot_diseo.presentation.chat.ChatScreen&#10;import com.example.chatbot_diseo.presentation.favoritos.FavoritosScreen&#10;import com.example.chatbot_diseo.presentation.historial.HistorialScreen&#10;import com.example.chatbot_diseo.presentation.notificaciones.NotificacionesScreen&#10;import com.example.chatbot_diseo.presentation.recursos.Pantalla_de_Recurso&#10;import com.example.chatbot_diseo.presentation.userperfil.PerfilScreen&#10;import com.example.chatbot_diseo.presentation.theme.ThemeViewModel&#10;&#10;@Composable&#10;fun AppNavGraph(&#10;    modifier: Modifier = Modifier,&#10;    navController: NavHostController,&#10;    themeViewModel: ThemeViewModel? = null&#10;) {&#10;    val context = LocalContext.current&#10;&#10;    NavHost(&#10;        navController = navController,&#10;        startDestination = &quot;login&quot;,&#10;        modifier = modifier&#10;    ) {&#10;        // Pantalla de Login&#10;        composable(&quot;login&quot;) {&#10;            LoginScreen(&#10;                onLogin = { role -&gt;&#10;                    // Verificar token guardado antes de navegar&#10;                    val token = TokenHolder.token&#10;                    if (token.isNullOrBlank()) {&#10;                        Toast.makeText(context, &quot;Login inválido (sin token)&quot;, Toast.LENGTH_SHORT).show()&#10;                        return@LoginScreen&#10;                    }&#10;                    Toast.makeText(context, &quot;Bienvenido! Rol: $role&quot;, Toast.LENGTH_SHORT).show()&#10;&#10;                    // Redirigir según el rol&#10;                    val destination = if (role == &quot;admin&quot;) &quot;admin_panel&quot; else &quot;chat&quot;&#10;&#10;                    navController.navigate(destination) {&#10;                        popUpTo(&quot;login&quot;) { inclusive = true }&#10;                    }&#10;                },&#10;                onForgotPassword = {&#10;                    navController.navigate(&quot;forgot_password&quot;)&#10;                }&#10;            )&#10;        }&#10;&#10;        // Pantalla de Recuperar Contraseña&#10;        composable(&quot;forgot_password&quot;) {&#10;            ForgotPasswordScreen(&#10;                onBack = {&#10;                    navController.popBackStack()&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;admin_panel&quot;) {&#10;            AdminPanelScreen(&#10;                onBack = { navController.popBackStack() },&#10;                onLogout = {&#10;                    // Limpiar token e ID del usuario&#10;                    TokenHolder.clear()&#10;                    navController.navigate(&quot;login&quot;) {&#10;                        popUpTo(0) { inclusive = true }&#10;                    }&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;chat&quot;) {&#10;            ChatScreen(navController = navController)&#10;        }&#10;&#10;        composable(&quot;calendario&quot;) {&#10;            Pantalla_Calendario()&#10;        }&#10;&#10;        composable(&quot;recursos&quot;) {&#10;            Pantalla_de_Recurso()&#10;        }&#10;&#10;        composable(&quot;perfil&quot;) {&#10;            val isDarkTheme by themeViewModel?.isDarkTheme?.collectAsState() ?: remember { mutableStateOf(false) }&#10;            PerfilScreen(&#10;                onLogout = {&#10;                    // Limpiar token e ID del usuario&#10;                    TokenHolder.clear()&#10;                    navController.navigate(&quot;login&quot;) {&#10;                        popUpTo(0) { inclusive = true }&#10;                    }&#10;                },&#10;                isDarkTheme = isDarkTheme,&#10;                onThemeToggle = { newValue -&gt;&#10;                    themeViewModel?.setDarkTheme(newValue)&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;notificaciones&quot;) {&#10;            NotificacionesScreen(onBack = { navController.popBackStack() })&#10;        }&#10;&#10;        // Historial: pasamos usuarioId desde TokenHolder&#10;        composable(&quot;historial&quot;) {&#10;            val usuarioId = TokenHolder.usuarioId ?: &quot;&quot;&#10;            HistorialScreen(&#10;                usuarioId = usuarioId,&#10;                onBack = { navController.popBackStack() },&#10;                onOpenChat = { conversacionId -&gt;&#10;                    // Navegar a chat con el id de conversacion&#10;                    navController.navigate(&quot;chat/$conversacionId&quot;) {&#10;                        launchSingleTop = true&#10;                        restoreState = true&#10;                    }&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;favoritos&quot;) {&#10;            FavoritosScreen(onBack = { navController.popBackStack() })&#10;        }&#10;&#10;        composable(&quot;ayuda&quot;) {&#10;            AyudaScreen(onBack = { navController.popBackStack() })&#10;        }&#10;&#10;        // Ruta para abrir chat con una conversacionId opcional&#10;        composable(&#10;            route = &quot;chat/{conversacionId}&quot;,&#10;            arguments = listOf(navArgument(&quot;conversacionId&quot;) { type = NavType.StringType })&#10;        ) { backStackEntry -&gt;&#10;            val convId = backStackEntry.arguments?.getString(&quot;conversacionId&quot;)&#10;            ChatScreen(navController = navController, initialConversacionId = convId)&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.chatbot_diseo.presentation.navigation&#10;&#10;import android.widget.Toast&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.navigation.NavHostController&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.navArgument&#10;import androidx.navigation.NavType&#10;import com.example.chatbot_diseo.data.api.TokenHolder&#10;import com.example.chatbot_diseo.presentation.admin.page.AdminPanelScreen&#10;import com.example.chatbot_diseo.presentation.auth.ForgotPasswordScreen&#10;import com.example.chatbot_diseo.presentation.auth.LoginScreen&#10;import com.example.chatbot_diseo.presentation.ayuda.AyudaScreen&#10;import com.example.chatbot_diseo.presentation.calendario.Pantalla_Calendario&#10;import com.example.chatbot_diseo.presentation.chat.ChatScreen&#10;import com.example.chatbot_diseo.presentation.favoritos.FavoritosScreen&#10;import com.example.chatbot_diseo.presentation.historial.HistorialScreen&#10;import com.example.chatbot_diseo.presentation.notificaciones.NotificacionesScreen&#10;import com.example.chatbot_diseo.presentation.recursos.Pantalla_de_Recurso&#10;import com.example.chatbot_diseo.presentation.userperfil.PerfilScreen&#10;import com.example.chatbot_diseo.presentation.theme.ThemeViewModel&#10;&#10;@Composable&#10;fun AppNavGraph(&#10;    modifier: Modifier = Modifier,&#10;    navController: NavHostController,&#10;    themeViewModel: ThemeViewModel? = null&#10;) {&#10;    val context = LocalContext.current&#10;&#10;    NavHost(&#10;        navController = navController,&#10;        startDestination = &quot;login&quot;,&#10;        modifier = modifier&#10;    ) {&#10;        // Pantalla de Login&#10;        composable(&quot;login&quot;) {&#10;            LoginScreen(&#10;                onLogin = { role -&gt;&#10;                    // Verificar token guardado antes de navegar&#10;                    val token = TokenHolder.token&#10;                    if (token.isNullOrBlank()) {&#10;                        Toast.makeText(context, &quot;Login inválido (sin token)&quot;, Toast.LENGTH_SHORT).show()&#10;                        return@LoginScreen&#10;                    }&#10;                    Toast.makeText(context, &quot;Bienvenido! Rol: $role&quot;, Toast.LENGTH_SHORT).show()&#10;&#10;                    // Redirigir según el rol&#10;                    val destination = if (role == &quot;admin&quot;) &quot;admin_panel&quot; else &quot;chat&quot;&#10;&#10;                    navController.navigate(destination) {&#10;                        popUpTo(&quot;login&quot;) { inclusive = true }&#10;                    }&#10;                },&#10;                onForgotPassword = {&#10;                    navController.navigate(&quot;forgot_password&quot;)&#10;                }&#10;            )&#10;        }&#10;&#10;        // Pantalla de Recuperar Contraseña&#10;        composable(&quot;forgot_password&quot;) {&#10;            ForgotPasswordScreen(&#10;                onBack = {&#10;                    navController.popBackStack()&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;admin_panel&quot;) {&#10;            AdminPanelScreen(&#10;                onBack = { navController.popBackStack() },&#10;                onLogout = {&#10;                    // Limpiar token e ID del usuario&#10;                    TokenHolder.clear()&#10;                    navController.navigate(&quot;login&quot;) {&#10;                        popUpTo(0) { inclusive = true }&#10;                    }&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;chat&quot;) {&#10;            ChatScreen(navController = navController)&#10;        }&#10;&#10;        composable(&quot;calendario&quot;) {&#10;            Pantalla_Calendario()&#10;        }&#10;&#10;        composable(&quot;recursos&quot;) {&#10;            Pantalla_de_Recurso()&#10;        }&#10;&#10;        composable(&quot;perfil&quot;) {&#10;            val isDarkTheme by themeViewModel?.isDarkTheme?.collectAsState() ?: remember { mutableStateOf(false) }&#10;            PerfilScreen(&#10;                onLogout = {&#10;                    // Limpiar token e ID del usuario&#10;                    TokenHolder.clear()&#10;                    navController.navigate(&quot;login&quot;) {&#10;                        popUpTo(0) { inclusive = true }&#10;                    }&#10;                },&#10;                isDarkTheme = isDarkTheme,&#10;                onThemeToggle = { newValue -&gt;&#10;                    themeViewModel?.setDarkTheme(newValue)&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;notificaciones&quot;) {&#10;            NotificacionesScreen(onBack = { navController.popBackStack() })&#10;        }&#10;&#10;        // Historial: pasamos usuarioId desde TokenHolder&#10;        composable(&quot;historial&quot;) {&#10;            val usuarioId = TokenHolder.usuarioId ?: &quot;&quot;&#10;            HistorialScreen(&#10;                usuarioId = usuarioId,&#10;                onBack = { navController.popBackStack() },&#10;                onOpenChat = { conversacionId -&gt;&#10;                    // Navegar a chat con el id de conversacion&#10;                    navController.navigate(&quot;chat/$conversacionId&quot;) {&#10;                        launchSingleTop = true&#10;                        restoreState = true&#10;                    }&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;favoritos&quot;) {&#10;            FavoritosScreen(onBack = { navController.popBackStack() })&#10;        }&#10;&#10;        composable(&quot;ayuda&quot;) {&#10;            AyudaScreen(onBack = { navController.popBackStack() })&#10;        }&#10;&#10;        // Ruta para abrir chat con una conversacionId opcional&#10;        composable(&#10;            route = &quot;chat/{conversacionId}&quot;,&#10;            arguments = listOf(navArgument(&quot;conversacionId&quot;) { type = NavType.StringType })&#10;        ) { backStackEntry -&gt;&#10;            val convId = backStackEntry.arguments?.getString(&quot;conversacionId&quot;)&#10;            // usar llamada posicional para evitar problemas con nombres de parámetros&#10;            ChatScreen(navController, convId)&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>