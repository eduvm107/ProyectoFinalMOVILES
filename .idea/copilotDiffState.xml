<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/chatbot_diseo/presentation/recursos/RecursosViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/chatbot_diseo/presentation/recursos/RecursosViewModel.kt" />
              <option name="originalContent" value="package com.example.chatbot_diseo.presentation.recursos&#10;&#10;import android.util.Log&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.chatbot_diseo.data.api.TokenHolder&#10;import com.example.chatbot_diseo.data.remote.apiChatBot.RetrofitInstance&#10;import com.example.chatbot_diseo.data.remote.model.Documento&#10;import com.example.chatbot_diseo.network.dto.request.FavoritoRequest&#10;import com.example.chatbot_diseo.presentation.favoritos.FavoritosViewModel&#10;import com.example.chatbot_diseo.presentation.favoritos.FavoritosBus&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;/**&#10; * ViewModel para manejar recursos y favoritos&#10; */&#10;class RecursosViewModel : ViewModel() {&#10;&#10;    private val favoritosApi = RetrofitInstance.favoritosApi&#10;    private val documentosApi = RetrofitInstance.documentosApi&#10;&#10;    //  PASO 1: Lista Observable de Documentos&#10;    private val _recursosList = MutableStateFlow&lt;List&lt;Documento&gt;&gt;(emptyList())&#10;    val recursosList: StateFlow&lt;List&lt;Documento&gt;&gt; = _recursosList&#10;&#10;    // Estado de carga&#10;    private val _isLoading = MutableStateFlow(false)&#10;    val isLoading: StateFlow&lt;Boolean&gt; = _isLoading&#10;&#10;    // Mensaje de error&#10;    private val _errorMessage = MutableStateFlow&lt;String?&gt;(null)&#10;    val errorMessage: StateFlow&lt;String?&gt; = _errorMessage&#10;&#10;    // StateFlow para mensajes de feedback&#10;    private val _mensajeFeedback = MutableStateFlow&lt;String?&gt;(null)&#10;    val mensajeFeedback: StateFlow&lt;String?&gt; = _mensajeFeedback&#10;&#10;    init {&#10;        cargarRecursos()&#10;    }&#10;&#10;    /**&#10;     * Cargar recursos desde la API&#10;     */&#10;    fun cargarRecursos() {&#10;        viewModelScope.launch {&#10;            _isLoading.value = true&#10;            _errorMessage.value = null&#10;&#10;            try {&#10;                Log.d(&quot;RECURSOS&quot;, &quot; Cargando recursos desde API...&quot;)&#10;                Log.d(&quot;RECURSOS&quot;, &quot; URL: GET /api/Documento&quot;)&#10;&#10;                val documentos = documentosApi.getAllDocumentos()&#10;&#10;                Log.d(&quot;RECURSOS&quot;, &quot;✅ Recursos cargados: ${documentos.size}&quot;)&#10;&#10;                //  LOG DETALLADO: Mostrar el primer documento completo para ver estructura&#10;                if (documentos.isNotEmpty()) {&#10;                    val primerDoc = documentos.first()&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;═══════════════════════════════════════&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot; PRIMER DOCUMENTO DESERIALIZADO:&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - id: ${primerDoc.id}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - titulo: ${primerDoc.titulo}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - descripcion: ${primerDoc.descripcion}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - url: ${primerDoc.url}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - categoria: ${primerDoc.categoria}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - tipo: ${primerDoc.tipo}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - favorito: ${primerDoc.favorito}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - autor: ${primerDoc.autor}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - fechaPublicacion: ${primerDoc.fechaPublicacion}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;═══════════════════════════════════════&quot;)&#10;&#10;                    // Mostrar todos los documentos con sus IDs&#10;                    documentos.forEachIndexed { index, doc -&gt;&#10;                        Log.d(&quot;RECURSOS_JSON&quot;, &quot; Documento #${index + 1}: id=${doc.id}, titulo=${doc.titulo}, favorito=${doc.favorito}&quot;)&#10;                    }&#10;                }&#10;&#10;                _recursosList.value = documentos&#10;&#10;                //  CARGAR ESTADO DE FAVORITOS DESDE LA API&#10;                cargarEstadoFavoritos()&#10;            } catch (e: Exception) {&#10;                Log.e(&quot;RECURSOS&quot;, &quot;❌ Error cargando recursos: ${e.message}&quot;)&#10;                Log.e(&quot;RECURSOS&quot;, &quot;❌ Stack trace: &quot;, e)&#10;                _errorMessage.value = &quot;Error: ${e.message ?: &quot;Desconocido&quot;}&quot;&#10;                _recursosList.value = emptyList()&#10;            } finally {&#10;                _isLoading.value = false&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Cargar el estado inicial de favoritos desde la API&#10;     * Esto sincroniza los corazones rojos con lo que está en la base de datos&#10;     */&#10;    private suspend fun cargarEstadoFavoritos() {&#10;        val usuarioId = TokenHolder.usuarioId&#10;        if (usuarioId.isNullOrEmpty()) {&#10;            Log.d(&quot;RECURSOS&quot;, &quot;⚠️ Sin usuario, no se cargan favoritos&quot;)&#10;            return&#10;        }&#10;&#10;        try {&#10;            Log.d(&quot;RECURSOS&quot;, &quot; Sincronizando estado de favoritos...&quot;)&#10;&#10;            // Obtener lista de favoritos del usuario&#10;            val response = favoritosApi.getMisFavoritos(usuarioId)&#10;&#10;            if (response.isSuccessful) {&#10;                val favoritos = response.body() ?: emptyList()&#10;&#10;                // Extraer los IDs de los recursos favoritos&#10;                val idsFavoritos = favoritos.map { it.id }.toSet()&#10;&#10;                Log.d(&quot;RECURSOS&quot;, &quot;✅ ${idsFavoritos.size} favoritos encontrados&quot;)&#10;&#10;                // Actualizar los documentos marcando cuáles son favoritos&#10;                val listaActualizada = _recursosList.value.map { doc -&gt;&#10;                    val esFavorito = doc.id in idsFavoritos&#10;                    if (doc.favorito != esFavorito) {&#10;                        Log.d(&quot;RECURSOS&quot;, &quot;  ❤️ Actualizando: ${doc.titulo} -&gt; favorito=$esFavorito&quot;)&#10;                        doc.copy(favorito = esFavorito)&#10;                    } else {&#10;                        doc&#10;                    }&#10;                }&#10;&#10;                _recursosList.value = listaActualizada&#10;                Log.d(&quot;RECURSOS&quot;, &quot; Corazones sincronizados con la base de datos&quot;)&#10;            } else {&#10;                Log.e(&quot;RECURSOS&quot;, &quot;❌ Error al obtener favoritos: ${response.code()}&quot;)&#10;            }&#10;        } catch (e: Exception) {&#10;            Log.e(&quot;RECURSOS&quot;, &quot;❌ Error sincronizando favoritos: ${e.message}&quot;)&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Toggle favorito - Agregar o eliminar de favoritos&#10;     * @param usuarioId ID del usuario&#10;     * @param recurso Documento a marcar/desmarcar como favorito&#10;     * @param favoritosViewModel ViewModel de favoritos para sincronización&#10;     */&#10;    fun toggleFavorito(usuarioId: String, recurso: Documento, favoritosViewModel: FavoritosViewModel? = null) {&#10;        val TIPO_RECURSO_API = &quot;documento&quot;&#10;&#10;        //  LOG DEBUG CRÍTICO: Verificar valores recibidos&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot;═══════════════════════════════════════&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; toggleFavorito llamado&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; Usuario ID: $usuarioId&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; Recurso ID: ${recurso.id}&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; Recurso Titulo: ${recurso.titulo}&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot;❤️ Recurso Favorito actual: ${recurso.favorito}&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; ID es null? ${recurso.id == null}&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; ID es empty? ${recurso.id?.isEmpty()}&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; ID length: ${recurso.id?.length ?: 0}&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot;═══════════════════════════════════════&quot;)&#10;&#10;        // 1. ️ VALIDACIÓN (Previene Error 400 Bad Request)&#10;        if (usuarioId.isEmpty() || recurso.id.isNullOrEmpty()) {&#10;            Log.e(&quot;FAVORITOS&quot;, &quot;❌ Error: ID de usuario o recurso nulo, el POST fallará.&quot;)&#10;            Log.e(&quot;FAVORITOS&quot;, &quot;   - usuarioId.isEmpty(): ${usuarioId.isEmpty()}&quot;)&#10;            Log.e(&quot;FAVORITOS&quot;, &quot;   - recurso.id.isNullOrEmpty(): ${recurso.id.isNullOrEmpty()}&quot;)&#10;            _mensajeFeedback.value = &quot;Error: ID de recurso inválido&quot;&#10;            return&#10;        }&#10;&#10;        viewModelScope.launch {&#10;            try {&#10;                val request = FavoritoRequest(&#10;                    tipoRecurso = TIPO_RECURSO_API,&#10;                    recursoId = recurso.id&#10;                )&#10;&#10;                Log.d(&quot;FAVORITOS&quot;, &quot; Enviando POST /Usuario/$usuarioId/favoritos&quot;)&#10;                Log.d(&quot;FAVORITOS&quot;, &quot;Body: tipoRecurso=$TIPO_RECURSO_API, recursoId=${recurso.id}&quot;)&#10;&#10;                // 2. LLAMADA POST a la DB&#10;                val response = favoritosApi.toggleFavorito(usuarioId, request)&#10;&#10;                if (response.isSuccessful) {&#10;                    val body = response.body()&#10;                    Log.d(&quot;FAVORITOS&quot;, &quot;✅ Respuesta exitosa: ${body?.message}&quot;)&#10;&#10;                    // 3.  FIX CRÍTICO: ACTUALIZACIÓN LOCAL INMEDIATA (Arregla el color del corazón)&#10;                    val listaActual = _recursosList.value.toMutableList()&#10;&#10;                    // Buscar el índice del documento que acabamos de modificar&#10;                    val index = listaActual.indexOfFirst { it.id == recurso.id }&#10;&#10;                    // Variable para guardar el nuevo estado y usarla en el mensaje&#10;                    var nuevoEstado = !recurso.favorito&#10;&#10;                    if (index != -1) {&#10;                        // Invertir el estado actual (true &lt;-&gt; false)&#10;                        nuevoEstado = !recurso.favorito&#10;                        val documentoActualizado = listaActual[index].copy(&#10;                            favorito = nuevoEstado&#10;                        )&#10;&#10;                        // Reemplazar el documento en la lista&#10;                        listaActual[index] = documentoActualizado&#10;&#10;                        // Emitir la nueva lista para refrescar la UI (el corazón cambia de color)&#10;                        _recursosList.value = listaActual&#10;&#10;                        Log.d(&quot;FAVORITOS&quot;, &quot; Lista local actualizada: ${recurso.titulo} en posición $index -&gt; favorito=$nuevoEstado&quot;)&#10;                    }&#10;&#10;                    // 4.  SINCRONIZACIÓN: Llamada al &quot;Jale&quot; (Arregla la persistencia en Mis Favoritos)&#10;                    favoritosViewModel?.forzarRecarga(usuarioId)&#10;&#10;                    // Emitir evento global para que cualquier listener recargue favoritos&#10;                    FavoritosBus.emitFavoritosChanged()&#10;&#10;                    // Mostrar feedback al usuario usando el nuevo estado local&#10;                    _mensajeFeedback.value = if (nuevoEstado) {&#10;                        &quot;✅ Agregado a favoritos&quot;&#10;                    } else {&#10;                        &quot;❌ Eliminado de favoritos&quot;&#10;                    }&#10;&#10;                    Log.d(&quot;FAVORITOS&quot;, &quot; Sincronización con pantalla de favoritos completada&quot;)&#10;                } else {&#10;                    // Manejar Error 400 (si el ID pasa la validación local pero el server lo rechaza)&#10;                    Log.e(&quot;FAVORITOS&quot;, &quot;❌ Error ${response.code()} al actualizar favorito&quot;)&#10;                    Log.e(&quot;FAVORITOS&quot;, &quot;Response: ${response.errorBody()?.string()}&quot;)&#10;                    _mensajeFeedback.value = &quot;Error al actualizar favorito (${response.code()})&quot;&#10;                }&#10;            } catch (e: Exception) {&#10;                Log.e(&quot;FAVORITOS&quot;, &quot;❌ Excepción de red al hacer POST: ${e.message}&quot;)&#10;                e.printStackTrace()&#10;                _mensajeFeedback.value = &quot;Error de conexión: ${e.message}&quot;&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Verifica si un recurso es favorito&#10;     * @param recursoId ID del recurso&#10;     * @return true si es favorito, false si no&#10;     */&#10;    fun esFavorito(recursoId: String?): Boolean {&#10;        if (recursoId == null) return false&#10;        val documento = _recursosList.value.find { it.id == recursoId }&#10;        return documento?.favorito ?: false&#10;    }&#10;&#10;    /**&#10;     * Limpia el mensaje de feedback&#10;     */&#10;    fun limpiarMensaje() {&#10;        _mensajeFeedback.value = null&#10;    }&#10;&#10;    /**&#10;     * Recargar recursos manualmente&#10;     */&#10;    fun recargarRecursos() {&#10;        cargarRecursos()&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.chatbot_diseo.presentation.recursos&#10;&#10;import android.util.Log&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.chatbot_diseo.data.api.TokenHolder&#10;import com.example.chatbot_diseo.data.remote.apiChatBot.RetrofitInstance&#10;import com.example.chatbot_diseo.data.remote.model.Documento&#10;import com.example.chatbot_diseo.network.dto.request.FavoritoRequest&#10;import com.example.chatbot_diseo.presentation.favoritos.FavoritosViewModel&#10;import com.example.chatbot_diseo.presentation.favoritos.FavoritosBus&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;/**&#10; * ViewModel para manejar recursos y favoritos&#10; */&#10;class RecursosViewModel : ViewModel() {&#10;&#10;    private val favoritosApi = RetrofitInstance.favoritosApi&#10;    private val documentosApi = RetrofitInstance.documentosApi&#10;&#10;    //  PASO 1: Lista Observable de Documentos&#10;    private val _recursosList = MutableStateFlow&lt;List&lt;Documento&gt;&gt;(emptyList())&#10;    val recursosList: StateFlow&lt;List&lt;Documento&gt;&gt; = _recursosList&#10;&#10;    // Estado de carga&#10;    private val _isLoading = MutableStateFlow(false)&#10;    val isLoading: StateFlow&lt;Boolean&gt; = _isLoading&#10;&#10;    // Mensaje de error&#10;    private val _errorMessage = MutableStateFlow&lt;String?&gt;(null)&#10;    val errorMessage: StateFlow&lt;String?&gt; = _errorMessage&#10;&#10;    // StateFlow para mensajes de feedback&#10;    private val _mensajeFeedback = MutableStateFlow&lt;String?&gt;(null)&#10;    val mensajeFeedback: StateFlow&lt;String?&gt; = _mensajeFeedback&#10;&#10;    init {&#10;        cargarRecursos()&#10;    }&#10;&#10;    /**&#10;     * Cargar recursos desde la API&#10;     */&#10;    fun cargarRecursos() {&#10;        viewModelScope.launch {&#10;            _isLoading.value = true&#10;            _errorMessage.value = null&#10;&#10;            try {&#10;                Log.d(&quot;RECURSOS&quot;, &quot; Cargando recursos desde API...&quot;)&#10;                Log.d(&quot;RECURSOS&quot;, &quot; URL: GET /api/Documento&quot;)&#10;&#10;                val documentos = documentosApi.getAllDocumentos()&#10;&#10;                Log.d(&quot;RECURSOS&quot;, &quot;✅ Recursos cargados: ${documentos.size}&quot;)&#10;&#10;                //  LOG DETALLADO: Mostrar el primer documento completo para ver estructura&#10;                if (documentos.isNotEmpty()) {&#10;                    val primerDoc = documentos.first()&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;═══════════════════════════════════════&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot; PRIMER DOCUMENTO DESERIALIZADO:&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - id: ${primerDoc.id}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - titulo: ${primerDoc.titulo}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - descripcion: ${primerDoc.descripcion}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - url: ${primerDoc.url}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - categoria: ${primerDoc.categoria}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - tipo: ${primerDoc.tipo}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - favorito: ${primerDoc.favorito}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - autor: ${primerDoc.autor}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;  - fechaPublicacion: ${primerDoc.fechaPublicacion}&quot;)&#10;                    Log.d(&quot;RECURSOS_JSON&quot;, &quot;═══════════════════════════════════════&quot;)&#10;&#10;                    // Mostrar todos los documentos con sus IDs&#10;                    documentos.forEachIndexed { index, doc -&gt;&#10;                        Log.d(&quot;RECURSOS_JSON&quot;, &quot; Documento #${index + 1}: id=${doc.id}, titulo=${doc.titulo}, favorito=${doc.favorito}&quot;)&#10;                    }&#10;                }&#10;&#10;                _recursosList.value = documentos&#10;&#10;                //  CARGAR ESTADO DE FAVORITOS DESDE LA API&#10;                cargarEstadoFavoritos()&#10;            } catch (e: Exception) {&#10;                Log.e(&quot;RECURSOS&quot;, &quot;❌ Error cargando recursos: ${e.message}&quot;)&#10;                Log.e(&quot;RECURSOS&quot;, &quot;❌ Stack trace: &quot;, e)&#10;                _errorMessage.value = &quot;Error: ${e.message ?: &quot;Desconocido&quot;}&quot;&#10;                _recursosList.value = emptyList()&#10;            } finally {&#10;                _isLoading.value = false&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Cargar el estado inicial de favoritos desde la API&#10;     * Esto sincroniza los corazones rojos con lo que está en la base de datos&#10;     */&#10;    private suspend fun cargarEstadoFavoritos() {&#10;        val usuarioId = TokenHolder.usuarioId&#10;        if (usuarioId.isNullOrEmpty()) {&#10;            Log.d(&quot;RECURSOS&quot;, &quot;⚠️ Sin usuario, no se cargan favoritos&quot;)&#10;            return&#10;        }&#10;&#10;        try {&#10;            Log.d(&quot;RECURSOS&quot;, &quot; Sincronizando estado de favoritos...&quot;)&#10;&#10;            // Obtener lista de favoritos del usuario&#10;            val response = favoritosApi.getMisFavoritos(usuarioId)&#10;&#10;            if (response.isSuccessful) {&#10;                val favoritos = response.body() ?: emptyList()&#10;&#10;                // Extraer los IDs de los recursos favoritos&#10;                val idsFavoritos = favoritos.map { it.id }.toSet()&#10;&#10;                Log.d(&quot;RECURSOS&quot;, &quot;✅ ${idsFavoritos.size} favoritos encontrados&quot;)&#10;&#10;                // Actualizar los documentos marcando cuáles son favoritos&#10;                val listaActualizada = _recursosList.value.map { doc -&gt;&#10;                    val esFavorito = doc.id in idsFavoritos&#10;                    if (doc.favorito != esFavorito) {&#10;                        Log.d(&quot;RECURSOS&quot;, &quot;  ❤️ Actualizando: ${doc.titulo} -&gt; favorito=$esFavorito&quot;)&#10;                        doc.copy(favorito = esFavorito)&#10;                    } else {&#10;                        doc&#10;                    }&#10;                }&#10;&#10;                _recursosList.value = listaActualizada&#10;                Log.d(&quot;RECURSOS&quot;, &quot; Corazones sincronizados con la base de datos&quot;)&#10;            } else {&#10;                Log.e(&quot;RECURSOS&quot;, &quot;❌ Error al obtener favoritos: ${response.code()}&quot;)&#10;            }&#10;        } catch (e: Exception) {&#10;            Log.e(&quot;RECURSOS&quot;, &quot;❌ Error sincronizando favoritos: ${e.message}&quot;)&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Toggle favorito - Agregar o eliminar de favoritos&#10;     * @param usuarioId ID del usuario&#10;     * @param recurso Documento a marcar/desmarcar como favorito&#10;     * @param favoritosViewModel ViewModel de favoritos para sincronización&#10;     */&#10;    fun toggleFavorito(usuarioId: String, recurso: Documento, favoritosViewModel: FavoritosViewModel? = null) {&#10;        val TIPO_RECURSO_API = &quot;documento&quot;&#10;&#10;        //  LOG DEBUG CRÍTICO: Verificar valores recibidos&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot;═══════════════════════════════════════&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; toggleFavorito llamado&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; Usuario ID: $usuarioId&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; Recurso ID: ${recurso.id}&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; Recurso Titulo: ${recurso.titulo}&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot;❤️ Recurso Favorito actual: ${recurso.favorito}&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; ID es null? ${recurso.id == null}&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; ID es empty? ${recurso.id?.isEmpty()}&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot; ID length: ${recurso.id?.length ?: 0}&quot;)&#10;        Log.d(&quot;FAVORITOS_DEBUG&quot;, &quot;═══════════════════════════════════════&quot;)&#10;&#10;        // 1. ️ VALIDACIÓN (Previene Error 400 Bad Request)&#10;        if (usuarioId.isEmpty() || recurso.id.isNullOrEmpty()) {&#10;            Log.e(&quot;FAVORITOS&quot;, &quot;❌ Error: ID de usuario o recurso nulo, el POST fallará.&quot;)&#10;            Log.e(&quot;FAVORITOS&quot;, &quot;   - usuarioId.isEmpty(): ${usuarioId.isEmpty()}&quot;)&#10;            Log.e(&quot;FAVORITOS&quot;, &quot;   - recurso.id.isNullOrEmpty(): ${recurso.id.isNullOrEmpty()}&quot;)&#10;            _mensajeFeedback.value = &quot;Error: ID de recurso inválido&quot;&#10;            return&#10;        }&#10;&#10;        viewModelScope.launch {&#10;            try {&#10;                val request = FavoritoRequest(&#10;                    tipoRecurso = TIPO_RECURSO_API,&#10;                    recursoId = recurso.id&#10;                )&#10;&#10;                Log.d(&quot;FAVORITOS&quot;, &quot; Enviando POST /Usuario/$usuarioId/favoritos&quot;)&#10;                Log.d(&quot;FAVORITOS&quot;, &quot;Body: tipoRecurso=$TIPO_RECURSO_API, recursoId=${recurso.id}&quot;)&#10;&#10;                // 2. LLAMADA POST a la DB&#10;                val response = favoritosApi.toggleFavorito(usuarioId, request)&#10;&#10;                if (response.isSuccessful) {&#10;                    val body = response.body()&#10;                    Log.d(&quot;FAVORITOS&quot;, &quot;✅ Respuesta exitosa: ${body?.message}&quot;)&#10;&#10;                    // Determinar el nuevo estado usando la respuesta del backend si está disponible&#10;                    val esFavoritoBackend = body?.esFavorito&#10;&#10;                    val listaActual = _recursosList.value.toMutableList()&#10;&#10;                    // Buscar el índice del documento que acabamos de modificar&#10;                    val index = listaActual.indexOfFirst { it.id == recurso.id }&#10;&#10;                    // Variable para guardar el nuevo estado y usarla en el mensaje&#10;                    var nuevoEstado = esFavoritoBackend ?: !recurso.favorito&#10;&#10;                    if (index != -1) {&#10;                        val documentoActualizado = listaActual[index].copy(&#10;                            favorito = nuevoEstado&#10;                        )&#10;&#10;                        // Reemplazar el documento en la lista&#10;                        listaActual[index] = documentoActualizado&#10;&#10;                        // Emitir la nueva lista para refrescar la UI (el corazón cambia de color)&#10;                        _recursosList.value = listaActual&#10;&#10;                        Log.d(&quot;FAVORITOS&quot;, &quot; Lista local actualizada: ${recurso.titulo} en posición $index -&gt; favorito=$nuevoEstado&quot;)&#10;                    }&#10;&#10;                    // 4.  SINCRONIZACIÓN: Llamada al &quot;Jale&quot; (Arregla la persistencia en Mis Favoritos)&#10;                    favoritosViewModel?.forzarRecarga(usuarioId)&#10;&#10;                    // Emitir evento global para que cualquier listener recargue favoritos&#10;                    FavoritosBus.emitFavoritosChanged()&#10;&#10;                    // Mostrar feedback al usuario usando el nuevo estado local&#10;                    _mensajeFeedback.value = if (nuevoEstado) {&#10;                        &quot;✅ Agregado a favoritos&quot;&#10;                    } else {&#10;                        &quot;❌ Eliminado de favoritos&quot;&#10;                    }&#10;&#10;                    Log.d(&quot;FAVORITOS&quot;, &quot; Sincronización con pantalla de favoritos completada&quot;)&#10;                } else {&#10;                    // Manejar Error 400 (si el ID pasa la validación local pero el server lo rechaza)&#10;                    Log.e(&quot;FAVORITOS&quot;, &quot;❌ Error ${response.code()} al actualizar favorito&quot;)&#10;                    Log.e(&quot;FAVORITOS&quot;, &quot;Response: ${response.errorBody()?.string()}&quot;)&#10;                    _mensajeFeedback.value = &quot;Error al actualizar favorito (${response.code()})&quot;&#10;                }&#10;            } catch (e: Exception) {&#10;                Log.e(&quot;FAVORITOS&quot;, &quot;❌ Excepción de red al hacer POST: ${e.message}&quot;)&#10;                e.printStackTrace()&#10;                _mensajeFeedback.value = &quot;Error de conexión: ${e.message}&quot;&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Verifica si un recurso es favorito&#10;     * @param recursoId ID del recurso&#10;     * @return true si es favorito, false si no&#10;     */&#10;    fun esFavorito(recursoId: String?): Boolean {&#10;        if (recursoId == null) return false&#10;        val documento = _recursosList.value.find { it.id == recursoId }&#10;        return documento?.favorito ?: false&#10;    }&#10;&#10;    /**&#10;     * Limpia el mensaje de feedback&#10;     */&#10;    fun limpiarMensaje() {&#10;        _mensajeFeedback.value = null&#10;    }&#10;&#10;    /**&#10;     * Recargar recursos manualmente&#10;     */&#10;    fun recargarRecursos() {&#10;        cargarRecursos()&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/chatbot_diseo/presentation/userperfil/PerfilScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/chatbot_diseo/presentation/userperfil/PerfilScreen.kt" />
              <option name="originalContent" value="@file:Suppress(&quot;DEPRECATION&quot;)&#10;&#10;package com.example.chatbot_diseo.presentation.userperfil&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.text.input.PasswordVisualTransformation&#10;import androidx.compose.ui.text.input.VisualTransformation&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import kotlinx.coroutines.delay&#10;import kotlinx.coroutines.launch&#10;&#10;data class UserProfile(&#10;    val name: String,&#10;    val email: String,&#10;    val position: String,&#10;    val department: String,&#10;    val phone: String,&#10;    val joinDate: String&#10;)&#10;&#10;@Composable&#10;fun PerfilScreen(&#10;    onLogout: () -&gt; Unit,&#10;    modifier: Modifier = Modifier,&#10;    sampleProfile: UserProfile? = null,&#10;    isDarkTheme: Boolean = false,&#10;    onThemeToggle: (Boolean) -&gt; Unit = {},&#10;    viewModel: PerfilViewModel = viewModel()&#10;) {&#10;    val currentUser by viewModel.currentUser.collectAsState()&#10;&#10;    // Usar los datos del usuario real si están disponibles, sino usar el sampleProfile o datos por defecto&#10;    val profile = sampleProfile ?: currentUser?.let {&#10;        UserProfile(&#10;            name = it.nombreCompleto ?: it.nombre ?: &quot;Usuario&quot;,&#10;            email = it.email ?: &quot;&quot;,&#10;            position = it.puesto ?: &quot;Empleado&quot;,&#10;            department = it.departamento ?: &quot;General&quot;,&#10;            phone = it.telefono ?: &quot;&quot;,  // Teléfono del usuario desde el backend&#10;            joinDate = &quot;&quot;  // No disponible desde el backend&#10;        )&#10;    } ?: UserProfile(&#10;        name = &quot;Usuario&quot;,&#10;        email = &quot;&quot;,&#10;        position = &quot;Empleado&quot;,&#10;        department = &quot;General&quot;,&#10;        phone = &quot;&quot;,&#10;        joinDate = &quot;&quot;&#10;    )&#10;&#10;    var showLogoutDialog by remember { mutableStateOf(false) }&#10;    var showChangePasswordDialog by remember { mutableStateOf(false) }&#10;    val changePasswordState by viewModel.changePasswordState.collectAsState()&#10;    var showSuccessMessage by remember { mutableStateOf(false) }&#10;    var showErrorMessage by remember { mutableStateOf&lt;String?&gt;(null) }&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    // Manejar estados de cambio de contraseña&#10;    LaunchedEffect(changePasswordState) {&#10;        when (val state = changePasswordState) {&#10;            is ChangePasswordState.Success -&gt; {&#10;                showSuccessMessage = true&#10;                viewModel.resetState()&#10;                coroutineScope.launch {&#10;                    delay(3000)&#10;                    showSuccessMessage = false&#10;                }&#10;            }&#10;            is ChangePasswordState.Error -&gt; {&#10;                showErrorMessage = state.message&#10;                viewModel.resetState()&#10;                coroutineScope.launch {&#10;                    delay(3000)&#10;                    showErrorMessage = null&#10;                }&#10;            }&#10;            else -&gt; {}&#10;        }&#10;    }&#10;&#10;    // Usar colores del tema de Material3 para soportar modo oscuro&#10;    val primaryColor = MaterialTheme.colorScheme.primary&#10;    val backgroundColor = MaterialTheme.colorScheme.background&#10;    val textPrimary = MaterialTheme.colorScheme.onBackground&#10;    val textSecondary = MaterialTheme.colorScheme.onSurfaceVariant&#10;&#10;    Surface(&#10;        modifier = modifier.fillMaxSize(),&#10;        color = backgroundColor&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .verticalScroll(rememberScrollState())&#10;        ) {&#10;            // Header azul institucional full-width, sin padding externo, con padding interno 24/20&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .background(Color(0xFF4A6B8A))&#10;                    .padding(vertical = 24.dp, horizontal = 20.dp),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Column(&#10;                    horizontalAlignment = Alignment.CenterHorizontally&#10;                ) {&#10;                    // Avatar circular más pequeña (foto o iniciales)&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .size(72.dp)&#10;                            .clip(CircleShape)&#10;                            .background(Color.White),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        // Mostrar iniciales robustas: hasta 2 letras, en mayúsculas, con fallback&#10;                        val initials = profile.name&#10;                            .trim()&#10;                            .split(Regex(&quot;\\s+&quot;))&#10;                            .mapNotNull { it.firstOrNull()?.toString() }&#10;                            .filter { it.isNotBlank() }&#10;                            .take(2)&#10;                            .joinToString(&quot;&quot;)&#10;                            .uppercase()&#10;                            .ifEmpty { &quot;U&quot; }&#10;                        Text(&#10;                            text = initials,&#10;                            fontSize = 28.sp,&#10;                            fontWeight = FontWeight.SemiBold,&#10;                            color = Color(0xFF4A6B8A)&#10;                        )&#10;                    }&#10;&#10;                    Spacer(modifier = Modifier.height(12.dp))&#10;&#10;                    Text(&#10;                        text = profile.name,&#10;                        fontSize = 20.sp,&#10;                        fontWeight = FontWeight.SemiBold,&#10;                        color = Color.White&#10;                    )&#10;&#10;                    Text(&#10;                        text = profile.position,&#10;                        fontSize = 13.sp,&#10;                        color = Color.White.copy(alpha = 0.9f)&#10;                    )&#10;                }&#10;            }&#10;&#10;            // Información personal&#10;            Column(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(24.dp),&#10;                verticalArrangement = Arrangement.spacedBy(16.dp)&#10;            ) {&#10;                Text(&#10;                    text = &quot;Información Personal&quot;,&#10;                    fontSize = 16.sp,&#10;                    fontWeight = FontWeight.SemiBold,&#10;                    color = textPrimary&#10;                )&#10;&#10;                ProfileInfoCard(&#10;                    icon = Icons.Default.Email,&#10;                    label = &quot;Correo Electrónico&quot;,&#10;                    value = profile.email,&#10;                    textPrimary = textPrimary,&#10;                    textSecondary = textSecondary&#10;                )&#10;&#10;                ProfileInfoCard(&#10;                    icon = Icons.Default.Phone,&#10;                    label = &quot;Teléfono&quot;,&#10;                    value = profile.phone.ifEmpty { &quot;No disponible&quot; },&#10;                    textPrimary = textPrimary,&#10;                    textSecondary = textSecondary&#10;                )&#10;&#10;                ProfileInfoCard(&#10;                    icon = Icons.Default.Work,&#10;                    label = &quot;Departamento&quot;,&#10;                    value = profile.department,&#10;                    textPrimary = textPrimary,&#10;                    textSecondary = textSecondary&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;&#10;                // Botones de acción&#10;                Text(&#10;                    text = &quot;Acciones&quot;,&#10;                    fontSize = 16.sp,&#10;                    fontWeight = FontWeight.SemiBold,&#10;                    color = textPrimary&#10;                )&#10;&#10;                ActionButton(&#10;                    icon = Icons.Default.Lock,&#10;                    text = &quot;Cambiar Contraseña&quot;,&#10;                    onClick = { showChangePasswordDialog = true }&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                // Botón de cerrar sesión remodelado&#10;                Button(&#10;                    onClick = { showLogoutDialog = true },&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .height(56.dp),&#10;                    colors = ButtonDefaults.buttonColors(&#10;                        containerColor = Color(0xFFE53935),&#10;                        contentColor = Color.White&#10;                    ),&#10;                    shape = RoundedCornerShape(12.dp)&#10;                ) {&#10;                    // Icono disponible en la librería actual&#10;                    Icon(&#10;                        imageVector = Icons.Filled.Logout,&#10;                        contentDescription = null,&#10;                        modifier = Modifier.size(20.dp),&#10;                        tint = Color.White&#10;                    )&#10;                    Spacer(modifier = Modifier.width(8.dp))&#10;                    Text(&#10;                        text = &quot;Cerrar Sesión&quot;,&#10;                        fontSize = 16.sp,&#10;                        fontWeight = FontWeight.SemiBold,&#10;                        color = Color.White&#10;                    )&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(32.dp))&#10;            }&#10;        }&#10;    }&#10;&#10;    // Mensajes de estado&#10;    Box(modifier = Modifier.fillMaxSize()) {&#10;        if (showSuccessMessage) {&#10;            Snackbar(&#10;                modifier = Modifier&#10;                    .align(Alignment.BottomCenter)&#10;                    .padding(16.dp),&#10;                containerColor = Color(0xFF10B981),&#10;                contentColor = Color.White&#10;            ) {&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically,&#10;                    horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;                ) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.CheckCircle,&#10;                        contentDescription = null&#10;                    )&#10;                    Text(&quot;Contraseña cambiada exitosamente&quot;)&#10;                }&#10;            }&#10;        }&#10;&#10;        showErrorMessage?.let { error -&gt;&#10;            Snackbar(&#10;                modifier = Modifier&#10;                    .align(Alignment.BottomCenter)&#10;                    .padding(16.dp),&#10;                containerColor = Color(0xFFDC2626),&#10;                contentColor = Color.White&#10;            ) {&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically,&#10;                    horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;                ) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Error,&#10;                        contentDescription = null&#10;                    )&#10;                    Text(error)&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    // Diálogo de cambio de contraseña&#10;    if (showChangePasswordDialog) {&#10;        ChangePasswordDialog(&#10;            onDismiss = { showChangePasswordDialog = false },&#10;            onConfirm = { currentPassword, newPassword -&gt;&#10;                viewModel.changePassword(currentPassword, newPassword)&#10;                showChangePasswordDialog = false&#10;            },&#10;            primaryColor = primaryColor,&#10;            textSecondary = textSecondary,&#10;            isLoading = changePasswordState is ChangePasswordState.Loading&#10;        )&#10;    }&#10;&#10;    // Diálogo de confirmación de logout&#10;    if (showLogoutDialog) {&#10;        AlertDialog(&#10;            onDismissRequest = { showLogoutDialog = false },&#10;            containerColor = MaterialTheme.colorScheme.surface,&#10;            title = {&#10;                Text(&#10;                    text = &quot;Cerrar Sesión&quot;,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = MaterialTheme.colorScheme.onSurface&#10;                )&#10;            },&#10;            text = {&#10;                Text(&#10;                    text = &quot;¿Estás seguro que deseas cerrar sesión?&quot;,&#10;                    color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                )&#10;            },&#10;            confirmButton = {&#10;                TextButton(&#10;                    onClick = {&#10;                        showLogoutDialog = false&#10;                        onLogout()&#10;                    },&#10;                    colors = ButtonDefaults.textButtonColors(&#10;                        contentColor = Color(0xFFE53935)&#10;                    )&#10;                ) {&#10;                    Text(&quot;Cerrar Sesión&quot;, fontWeight = FontWeight.SemiBold)&#10;                }&#10;            },&#10;            dismissButton = {&#10;                TextButton(&#10;                    onClick = { showLogoutDialog = false },&#10;                    colors = ButtonDefaults.textButtonColors(&#10;                        contentColor = primaryColor&#10;                    )&#10;                ) {&#10;                    Text(&quot;Cancelar&quot;)&#10;                }&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ProfileInfoCard(&#10;    icon: ImageVector,&#10;    label: String,&#10;    value: String,&#10;    textPrimary: Color,&#10;    textSecondary: Color&#10;) {&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White&#10;        ),&#10;        shape = RoundedCornerShape(16.dp),&#10;        elevation = CardDefaults.cardElevation(2.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .size(44.dp)&#10;                    .clip(RoundedCornerShape(22.dp))&#10;                    .background(Color(0xFFF2F3F5)),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Icon(&#10;                    imageVector = icon,&#10;                    contentDescription = null,&#10;                    tint = Color(0xFF6B6B6B),&#10;                    modifier = Modifier.size(20.dp)&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.width(16.dp))&#10;&#10;            Column {&#10;                Text(&#10;                    text = label,&#10;                    fontSize = 13.sp,&#10;                    color = textSecondary,&#10;                    fontWeight = FontWeight.Normal&#10;                )&#10;                Spacer(modifier = Modifier.height(4.dp))&#10;                Text(&#10;                    text = value,&#10;                    fontSize = 14.sp,&#10;                    color = textPrimary,&#10;                    fontWeight = FontWeight.SemiBold&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ActionButton(&#10;    icon: ImageVector,&#10;    text: String,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    // Usar card blanca con elevación suave para mantener consistencia visual&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .height(56.dp)&#10;            .clickable { onClick() },&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White&#10;        ),&#10;        shape = RoundedCornerShape(16.dp),&#10;        elevation = CardDefaults.cardElevation(2.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(horizontal = 16.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .size(44.dp)&#10;                    .clip(RoundedCornerShape(22.dp))&#10;                    .background(Color(0xFFF2F3F5)),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Icon(&#10;                    imageVector = icon,&#10;                    contentDescription = null,&#10;                    tint = Color(0xFF6B6B6B),&#10;                    modifier = Modifier.size(20.dp)&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.width(12.dp))&#10;&#10;            Text(&#10;                text = text,&#10;                fontSize = 15.sp,&#10;                fontWeight = FontWeight.SemiBold,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;&#10;            Icon(&#10;                imageVector = Icons.Default.ChevronRight,&#10;                contentDescription = null,&#10;                modifier = Modifier.size(20.dp),&#10;                tint = Color(0xFFB0B0B0)&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ThemeToggleCard(&#10;    isDarkTheme: Boolean,&#10;    onToggle: (Boolean) -&gt; Unit,&#10;    primaryColor: Color,&#10;    textPrimary: Color,&#10;    textSecondary: Color&#10;) {&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White&#10;        ),&#10;        shape = RoundedCornerShape(16.dp),&#10;        elevation = CardDefaults.cardElevation(2.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp),&#10;            verticalAlignment = Alignment.CenterVertically,&#10;            horizontalArrangement = Arrangement.SpaceBetween&#10;        ) {&#10;            Row(&#10;                verticalAlignment = Alignment.CenterVertically,&#10;                modifier = Modifier.weight(1f)&#10;            ) {&#10;                Box(&#10;                    modifier = Modifier&#10;                        .size(44.dp)&#10;                        .clip(RoundedCornerShape(22.dp))&#10;                        .background(Color(0xFFF2F3F5)),&#10;                    contentAlignment = Alignment.Center&#10;                ) {&#10;                    Icon(&#10;                        imageVector = if (isDarkTheme) Icons.Default.DarkMode else Icons.Default.LightMode,&#10;                        contentDescription = null,&#10;                        tint = Color(0xFF6B6B6B),&#10;                        modifier = Modifier.size(20.dp)&#10;                    )&#10;                }&#10;&#10;                Spacer(modifier = Modifier.width(16.dp))&#10;&#10;                Column {&#10;                    Text(&#10;                        text = &quot;Tema&quot;,&#10;                        fontSize = 14.sp,&#10;                        color = textPrimary,&#10;                        fontWeight = FontWeight.SemiBold&#10;                    )&#10;                    Spacer(modifier = Modifier.height(4.dp))&#10;                    Text(&#10;                        text = if (isDarkTheme) &quot;Modo Oscuro&quot; else &quot;Modo Claro&quot;,&#10;                        fontSize = 13.sp,&#10;                        color = textSecondary,&#10;                        fontWeight = FontWeight.Normal&#10;                    )&#10;                }&#10;            }&#10;&#10;            Switch(&#10;                checked = isDarkTheme,&#10;                onCheckedChange = onToggle,&#10;                colors = SwitchDefaults.colors(&#10;                    checkedThumbColor = Color.White,&#10;                    checkedTrackColor = primaryColor,&#10;                    uncheckedThumbColor = Color.White,&#10;                    uncheckedTrackColor = Color.LightGray&#10;                )&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ChangePasswordDialog(&#10;    onDismiss: () -&gt; Unit,&#10;    onConfirm: (String, String) -&gt; Unit,&#10;    primaryColor: Color,&#10;    textSecondary: Color,&#10;    isLoading: Boolean = false&#10;) {&#10;    var currentPassword by remember { mutableStateOf(&quot;&quot;) }&#10;    var newPassword by remember { mutableStateOf(&quot;&quot;) }&#10;    var confirmPassword by remember { mutableStateOf(&quot;&quot;) }&#10;    var currentPasswordVisible by remember { mutableStateOf(false) }&#10;    var newPasswordVisible by remember { mutableStateOf(false) }&#10;    var confirmPasswordVisible by remember { mutableStateOf(false) }&#10;    var errorMessage by remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    AlertDialog(&#10;        onDismissRequest = onDismiss,&#10;        containerColor = MaterialTheme.colorScheme.surface,&#10;        title = {&#10;            Text(&#10;                text = &quot;Cambiar Contraseña&quot;,&#10;                fontWeight = FontWeight.Bold,&#10;                color = MaterialTheme.colorScheme.onSurface&#10;            )&#10;        },&#10;        text = {&#10;            Column(&#10;                verticalArrangement = Arrangement.spacedBy(12.dp)&#10;            ) {&#10;                if (errorMessage.isNotEmpty()) {&#10;                    Card(&#10;                        colors = CardDefaults.cardColors(&#10;                            containerColor = Color(0xFFFEE2E2)&#10;                        ),&#10;                        shape = RoundedCornerShape(8.dp)&#10;                    ) {&#10;                        Text(&#10;                            text = errorMessage,&#10;                            color = Color(0xFFDC2626),&#10;                            fontSize = 13.sp,&#10;                            modifier = Modifier.padding(12.dp)&#10;                        )&#10;                    }&#10;                }&#10;&#10;                // Contraseña actual&#10;                OutlinedTextField(&#10;                    value = currentPassword,&#10;                    onValueChange = {&#10;                        currentPassword = it&#10;                        errorMessage = &quot;&quot;&#10;                    },&#10;                    label = { Text(&quot;Contraseña Actual&quot;) },&#10;                    visualTransformation = if (currentPasswordVisible)&#10;                        VisualTransformation.None&#10;                    else&#10;                        PasswordVisualTransformation(),&#10;                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password),&#10;                    trailingIcon = {&#10;                        IconButton(onClick = { currentPasswordVisible = !currentPasswordVisible }) {&#10;                            Icon(&#10;                                imageVector = if (currentPasswordVisible)&#10;                                    Icons.Default.Visibility&#10;                                else&#10;                                    Icons.Default.VisibilityOff,&#10;                                contentDescription = if (currentPasswordVisible)&#10;                                    &quot;Ocultar contraseña&quot;&#10;                                else&#10;                                    &quot;Mostrar contraseña&quot;&#10;                            )&#10;                        }&#10;                    },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    singleLine = true,&#10;                    colors = OutlinedTextFieldDefaults.colors(&#10;                        focusedBorderColor = primaryColor,&#10;                        focusedLabelColor = primaryColor,&#10;                        cursorColor = primaryColor&#10;                    )&#10;                )&#10;&#10;                // Nueva contraseña&#10;                OutlinedTextField(&#10;                    value = newPassword,&#10;                    onValueChange = {&#10;                        newPassword = it&#10;                        errorMessage = &quot;&quot;&#10;                    },&#10;                    label = { Text(&quot;Nueva Contraseña&quot;) },&#10;                    visualTransformation = if (newPasswordVisible)&#10;                        VisualTransformation.None&#10;                    else&#10;                        PasswordVisualTransformation(),&#10;                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password),&#10;                    trailingIcon = {&#10;                        IconButton(onClick = { newPasswordVisible = !newPasswordVisible }) {&#10;                            Icon(&#10;                                imageVector = if (newPasswordVisible)&#10;                                    Icons.Default.Visibility&#10;                                else&#10;                                    Icons.Default.VisibilityOff,&#10;                                contentDescription = if (newPasswordVisible)&#10;                                    &quot;Ocultar contraseña&quot;&#10;                                else&#10;                                    &quot;Mostrar contraseña&quot;&#10;                            )&#10;                        }&#10;                    },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    singleLine = true,&#10;                    colors = OutlinedTextFieldDefaults.colors(&#10;                        focusedBorderColor = primaryColor,&#10;                        focusedLabelColor = primaryColor,&#10;                        cursorColor = primaryColor&#10;                    )&#10;                )&#10;&#10;                // Confirmar contraseña&#10;                OutlinedTextField(&#10;                    value = confirmPassword,&#10;                    onValueChange = {&#10;                        confirmPassword = it&#10;                        errorMessage = &quot;&quot;&#10;                    },&#10;                    label = { Text(&quot;Confirmar Nueva Contraseña&quot;) },&#10;                    visualTransformation = if (confirmPasswordVisible)&#10;                        VisualTransformation.None&#10;                    else&#10;                        PasswordVisualTransformation(),&#10;                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password),&#10;                    trailingIcon = {&#10;                        IconButton(onClick = { confirmPasswordVisible = !confirmPasswordVisible }) {&#10;                            Icon(&#10;                                imageVector = if (confirmPasswordVisible)&#10;                                    Icons.Default.Visibility&#10;                                else&#10;                                    Icons.Default.VisibilityOff,&#10;                                contentDescription = if (confirmPasswordVisible)&#10;                                    &quot;Ocultar contraseña&quot;&#10;                                else&#10;                                    &quot;Mostrar contraseña&quot;&#10;                            )&#10;                        }&#10;                    },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    singleLine = true,&#10;                    colors = OutlinedTextFieldDefaults.colors(&#10;                        focusedBorderColor = primaryColor,&#10;                        focusedLabelColor = primaryColor,&#10;                        cursorColor = primaryColor&#10;                    )&#10;                )&#10;&#10;                Text(&#10;                    text = &quot;La contraseña debe tener al menos 6 caracteres&quot;,&#10;                    fontSize = 12.sp,&#10;                    color = textSecondary&#10;                )&#10;            }&#10;        },&#10;        confirmButton = {&#10;            Button(&#10;                onClick = {&#10;                    when {&#10;                        currentPassword.isEmpty() -&gt; {&#10;                            errorMessage = &quot;Ingresa tu contraseña actual&quot;&#10;                        }&#10;                        newPassword.isEmpty() -&gt; {&#10;                            errorMessage = &quot;Ingresa una nueva contraseña&quot;&#10;                        }&#10;                        newPassword.length &lt; 6 -&gt; {&#10;                            errorMessage = &quot;La contraseña debe tener al menos 6 caracteres&quot;&#10;                        }&#10;                        newPassword != confirmPassword -&gt; {&#10;                            errorMessage = &quot;Las contraseñas no coinciden&quot;&#10;                        }&#10;                        currentPassword == newPassword -&gt; {&#10;                            errorMessage = &quot;La nueva contraseña debe ser diferente a la actual&quot;&#10;                        }&#10;                        else -&gt; {&#10;                            onConfirm(currentPassword, newPassword)&#10;                        }&#10;                    }&#10;                },&#10;                colors = ButtonDefaults.buttonColors(&#10;                    containerColor = primaryColor&#10;                ),&#10;                enabled = !isLoading&#10;            ) {&#10;                if (isLoading) {&#10;                    CircularProgressIndicator(&#10;                        modifier = Modifier.size(20.dp),&#10;                        color = Color.White,&#10;                        strokeWidth = 2.dp&#10;                    )&#10;                } else {&#10;                    Text(&quot;Cambiar&quot;)&#10;                }&#10;            }&#10;        },&#10;        dismissButton = {&#10;            TextButton(&#10;                onClick = onDismiss,&#10;                colors = ButtonDefaults.textButtonColors(&#10;                    contentColor = textSecondary&#10;                )&#10;            ) {&#10;                Text(&quot;Cancelar&quot;)&#10;            }&#10;        }&#10;    )&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun PerfilScreenPreview() {&#10;    PerfilScreen(onLogout = {})&#10;}&#10;" />
              <option name="updatedContent" value="@file:Suppress(&quot;DEPRECATION&quot;)&#10;&#10;package com.example.chatbot_diseo.presentation.userperfil&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.text.input.PasswordVisualTransformation&#10;import androidx.compose.ui.text.input.VisualTransformation&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import kotlinx.coroutines.delay&#10;import kotlinx.coroutines.launch&#10;&#10;data class UserProfile(&#10;    val name: String,&#10;    val email: String,&#10;    val position: String,&#10;    val department: String,&#10;    val phone: String,&#10;    val joinDate: String&#10;)&#10;&#10;@Composable&#10;fun PerfilScreen(&#10;    onLogout: () -&gt; Unit,&#10;    modifier: Modifier = Modifier,&#10;    sampleProfile: UserProfile? = null,&#10;    viewModel: PerfilViewModel = viewModel()&#10;) {&#10;    val currentUser by viewModel.currentUser.collectAsState()&#10;&#10;    // Usar los datos del usuario real si están disponibles, sino usar el sampleProfile o datos por defecto&#10;    val profile = sampleProfile ?: currentUser?.let {&#10;        UserProfile(&#10;            name = it.nombreCompleto ?: it.nombre ?: &quot;Usuario&quot;,&#10;            email = it.email ?: &quot;&quot;,&#10;            position = it.puesto ?: &quot;Empleado&quot;,&#10;            department = it.departamento ?: &quot;General&quot;,&#10;            phone = it.telefono ?: &quot;&quot;,  // Teléfono del usuario desde el backend&#10;            joinDate = &quot;&quot;  // No disponible desde el backend&#10;        )&#10;    } ?: UserProfile(&#10;        name = &quot;Usuario&quot;,&#10;        email = &quot;&quot;,&#10;        position = &quot;Empleado&quot;,&#10;        department = &quot;General&quot;,&#10;        phone = &quot;&quot;,&#10;        joinDate = &quot;&quot;&#10;    )&#10;&#10;    var showLogoutDialog by remember { mutableStateOf(false) }&#10;    var showChangePasswordDialog by remember { mutableStateOf(false) }&#10;    val changePasswordState by viewModel.changePasswordState.collectAsState()&#10;    var showSuccessMessage by remember { mutableStateOf(false) }&#10;    var showErrorMessage by remember { mutableStateOf&lt;String?&gt;(null) }&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    // Manejar estados de cambio de contraseña&#10;    LaunchedEffect(changePasswordState) {&#10;        when (val state = changePasswordState) {&#10;            is ChangePasswordState.Success -&gt; {&#10;                showSuccessMessage = true&#10;                viewModel.resetState()&#10;                coroutineScope.launch {&#10;                    delay(3000)&#10;                    showSuccessMessage = false&#10;                }&#10;            }&#10;            is ChangePasswordState.Error -&gt; {&#10;                showErrorMessage = state.message&#10;                viewModel.resetState()&#10;                coroutineScope.launch {&#10;                    delay(3000)&#10;                    showErrorMessage = null&#10;                }&#10;            }&#10;            else -&gt; {}&#10;        }&#10;    }&#10;&#10;    // Usar colores del tema de Material3&#10;    val primaryColor = MaterialTheme.colorScheme.primary&#10;    val backgroundColor = MaterialTheme.colorScheme.background&#10;    val textPrimary = MaterialTheme.colorScheme.onBackground&#10;    val textSecondary = MaterialTheme.colorScheme.onSurfaceVariant&#10;&#10;    Surface(&#10;        modifier = modifier.fillMaxSize(),&#10;        color = backgroundColor&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .verticalScroll(rememberScrollState())&#10;        ) {&#10;            // Header azul institucional full-width, sin padding externo, con padding interno 24/20&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .background(Color(0xFF4A6B8A))&#10;                    .padding(vertical = 24.dp, horizontal = 20.dp),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Column(&#10;                    horizontalAlignment = Alignment.CenterHorizontally&#10;                ) {&#10;                    // Avatar circular más pequeña (foto o iniciales)&#10;                    Box(&#10;                        modifier = Modifier&#10;                            .size(72.dp)&#10;                            .clip(CircleShape)&#10;                            .background(Color.White),&#10;                        contentAlignment = Alignment.Center&#10;                    ) {&#10;                        // Mostrar iniciales robustas: hasta 2 letras, en mayúsculas, con fallback&#10;                        val initials = profile.name&#10;                            .trim()&#10;                            .split(Regex(&quot;\\s+&quot;))&#10;                            .mapNotNull { it.firstOrNull()?.toString() }&#10;                            .filter { it.isNotBlank() }&#10;                            .take(2)&#10;                            .joinToString(&quot;&quot;)&#10;                            .uppercase()&#10;                            .ifEmpty { &quot;U&quot; }&#10;                        Text(&#10;                            text = initials,&#10;                            fontSize = 28.sp,&#10;                            fontWeight = FontWeight.SemiBold,&#10;                            color = Color(0xFF4A6B8A)&#10;                        )&#10;                    }&#10;&#10;                    Spacer(modifier = Modifier.height(12.dp))&#10;&#10;                    Text(&#10;                        text = profile.name,&#10;                        fontSize = 20.sp,&#10;                        fontWeight = FontWeight.SemiBold,&#10;                        color = Color.White&#10;                    )&#10;&#10;                    Text(&#10;                        text = profile.position,&#10;                        fontSize = 13.sp,&#10;                        color = Color.White.copy(alpha = 0.9f)&#10;                    )&#10;                }&#10;            }&#10;&#10;            // Información personal&#10;            Column(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(24.dp),&#10;                verticalArrangement = Arrangement.spacedBy(16.dp)&#10;            ) {&#10;                Text(&#10;                    text = &quot;Información Personal&quot;,&#10;                    fontSize = 16.sp,&#10;                    fontWeight = FontWeight.SemiBold,&#10;                    color = textPrimary&#10;                )&#10;&#10;                ProfileInfoCard(&#10;                    icon = Icons.Default.Email,&#10;                    label = &quot;Correo Electrónico&quot;,&#10;                    value = profile.email,&#10;                    textPrimary = textPrimary,&#10;                    textSecondary = textSecondary&#10;                )&#10;&#10;                ProfileInfoCard(&#10;                    icon = Icons.Default.Phone,&#10;                    label = &quot;Teléfono&quot;,&#10;                    value = profile.phone.ifEmpty { &quot;No disponible&quot; },&#10;                    textPrimary = textPrimary,&#10;                    textSecondary = textSecondary&#10;                )&#10;&#10;                ProfileInfoCard(&#10;                    icon = Icons.Default.Work,&#10;                    label = &quot;Departamento&quot;,&#10;                    value = profile.department,&#10;                    textPrimary = textPrimary,&#10;                    textSecondary = textSecondary&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;&#10;                // Botones de acción&#10;                Text(&#10;                    text = &quot;Acciones&quot;,&#10;                    fontSize = 16.sp,&#10;                    fontWeight = FontWeight.SemiBold,&#10;                    color = textPrimary&#10;                )&#10;&#10;                ActionButton(&#10;                    icon = Icons.Default.Lock,&#10;                    text = &quot;Cambiar Contraseña&quot;,&#10;                    onClick = { showChangePasswordDialog = true }&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                // Botón de cerrar sesión remodelado&#10;                Button(&#10;                    onClick = { showLogoutDialog = true },&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .height(56.dp),&#10;                    colors = ButtonDefaults.buttonColors(&#10;                        containerColor = Color(0xFFE53935),&#10;                        contentColor = Color.White&#10;                    ),&#10;                    shape = RoundedCornerShape(12.dp)&#10;                ) {&#10;                    // Icono disponible en la librería actual&#10;                    Icon(&#10;                        imageVector = Icons.Filled.Logout,&#10;                        contentDescription = null,&#10;                        modifier = Modifier.size(20.dp),&#10;                        tint = Color.White&#10;                    )&#10;                    Spacer(modifier = Modifier.width(8.dp))&#10;                    Text(&#10;                        text = &quot;Cerrar Sesión&quot;,&#10;                        fontSize = 16.sp,&#10;                        fontWeight = FontWeight.SemiBold,&#10;                        color = Color.White&#10;                    )&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(32.dp))&#10;            }&#10;        }&#10;    }&#10;&#10;    // Mensajes de estado&#10;    Box(modifier = Modifier.fillMaxSize()) {&#10;        if (showSuccessMessage) {&#10;            Snackbar(&#10;                modifier = Modifier&#10;                    .align(Alignment.BottomCenter)&#10;                    .padding(16.dp),&#10;                containerColor = Color(0xFF10B981),&#10;                contentColor = Color.White&#10;            ) {&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically,&#10;                    horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;                ) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.CheckCircle,&#10;                        contentDescription = null&#10;                    )&#10;                    Text(&quot;Contraseña cambiada exitosamente&quot;)&#10;                }&#10;            }&#10;        }&#10;&#10;        showErrorMessage?.let { error -&gt;&#10;            Snackbar(&#10;                modifier = Modifier&#10;                    .align(Alignment.BottomCenter)&#10;                    .padding(16.dp),&#10;                containerColor = Color(0xFFDC2626),&#10;                contentColor = Color.White&#10;            ) {&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically,&#10;                    horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;                ) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.Error,&#10;                        contentDescription = null&#10;                    )&#10;                    Text(error)&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    // Diálogo de cambio de contraseña&#10;    if (showChangePasswordDialog) {&#10;        ChangePasswordDialog(&#10;            onDismiss = { showChangePasswordDialog = false },&#10;            onConfirm = { currentPassword, newPassword -&gt;&#10;                viewModel.changePassword(currentPassword, newPassword)&#10;                showChangePasswordDialog = false&#10;            },&#10;            primaryColor = primaryColor,&#10;            textSecondary = textSecondary,&#10;            isLoading = changePasswordState is ChangePasswordState.Loading&#10;        )&#10;    }&#10;&#10;    // Diálogo de confirmación de logout&#10;    if (showLogoutDialog) {&#10;        AlertDialog(&#10;            onDismissRequest = { showLogoutDialog = false },&#10;            containerColor = MaterialTheme.colorScheme.surface,&#10;            title = {&#10;                Text(&#10;                    text = &quot;Cerrar Sesión&quot;,&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = MaterialTheme.colorScheme.onSurface&#10;                )&#10;            },&#10;            text = {&#10;                Text(&#10;                    text = &quot;¿Estás seguro que deseas cerrar sesión?&quot;,&#10;                    color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                )&#10;            },&#10;            confirmButton = {&#10;                TextButton(&#10;                    onClick = {&#10;                        showLogoutDialog = false&#10;                        onLogout()&#10;                    },&#10;                    colors = ButtonDefaults.textButtonColors(&#10;                        contentColor = Color(0xFFE53935)&#10;                    )&#10;                ) {&#10;                    Text(&quot;Cerrar Sesión&quot;, fontWeight = FontWeight.SemiBold)&#10;                }&#10;            },&#10;            dismissButton = {&#10;                TextButton(&#10;                    onClick = { showLogoutDialog = false },&#10;                    colors = ButtonDefaults.textButtonColors(&#10;                        contentColor = primaryColor&#10;                    )&#10;                ) {&#10;                    Text(&quot;Cancelar&quot;)&#10;                }&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ProfileInfoCard(&#10;    icon: ImageVector,&#10;    label: String,&#10;    value: String,&#10;    textPrimary: Color,&#10;    textSecondary: Color&#10;) {&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White&#10;        ),&#10;        shape = RoundedCornerShape(16.dp),&#10;        elevation = CardDefaults.cardElevation(2.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .size(44.dp)&#10;                    .clip(RoundedCornerShape(22.dp))&#10;                    .background(Color(0xFFF2F3F5)),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Icon(&#10;                    imageVector = icon,&#10;                    contentDescription = null,&#10;                    tint = Color(0xFF6B6B6B),&#10;                    modifier = Modifier.size(20.dp)&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.width(16.dp))&#10;&#10;            Column {&#10;                Text(&#10;                    text = label,&#10;                    fontSize = 13.sp,&#10;                    color = textSecondary,&#10;                    fontWeight = FontWeight.Normal&#10;                )&#10;                Spacer(modifier = Modifier.height(4.dp))&#10;                Text(&#10;                    text = value,&#10;                    fontSize = 14.sp,&#10;                    color = textPrimary,&#10;                    fontWeight = FontWeight.SemiBold&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ActionButton(&#10;    icon: ImageVector,&#10;    text: String,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    // Usar card blanca con elevación suave para mantener consistencia visual&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .height(56.dp)&#10;            .clickable { onClick() },&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = Color.White&#10;        ),&#10;        shape = RoundedCornerShape(16.dp),&#10;        elevation = CardDefaults.cardElevation(2.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(horizontal = 16.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .size(44.dp)&#10;                    .clip(RoundedCornerShape(22.dp))&#10;                    .background(Color(0xFFF2F3F5)),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Icon(&#10;                    imageVector = icon,&#10;                    contentDescription = null,&#10;                    tint = Color(0xFF6B6B6B),&#10;                    modifier = Modifier.size(20.dp)&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.width(12.dp))&#10;&#10;            Text(&#10;                text = text,&#10;                fontSize = 15.sp,&#10;                fontWeight = FontWeight.SemiBold,&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;&#10;            Icon(&#10;                imageVector = Icons.Default.ChevronRight,&#10;                contentDescription = null,&#10;                modifier = Modifier.size(20.dp),&#10;                tint = Color(0xFFB0B0B0)&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun ChangePasswordDialog(&#10;    onDismiss: () -&gt; Unit,&#10;    onConfirm: (String, String) -&gt; Unit,&#10;    primaryColor: Color,&#10;    textSecondary: Color,&#10;    isLoading: Boolean = false&#10;) {&#10;    var currentPassword by remember { mutableStateOf(&quot;&quot;) }&#10;    var newPassword by remember { mutableStateOf(&quot;&quot;) }&#10;    var confirmPassword by remember { mutableStateOf(&quot;&quot;) }&#10;    var currentPasswordVisible by remember { mutableStateOf(false) }&#10;    var newPasswordVisible by remember { mutableStateOf(false) }&#10;    var confirmPasswordVisible by remember { mutableStateOf(false) }&#10;    var errorMessage by remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    AlertDialog(&#10;        onDismissRequest = onDismiss,&#10;        containerColor = MaterialTheme.colorScheme.surface,&#10;        title = {&#10;            Text(&#10;                text = &quot;Cambiar Contraseña&quot;,&#10;                fontWeight = FontWeight.Bold,&#10;                color = MaterialTheme.colorScheme.onSurface&#10;            )&#10;        },&#10;        text = {&#10;            Column(&#10;                verticalArrangement = Arrangement.spacedBy(12.dp)&#10;            ) {&#10;                if (errorMessage.isNotEmpty()) {&#10;                    Card(&#10;                        colors = CardDefaults.cardColors(&#10;                            containerColor = Color(0xFFFEE2E2)&#10;                        ),&#10;                        shape = RoundedCornerShape(8.dp)&#10;                    ) {&#10;                        Text(&#10;                            text = errorMessage,&#10;                            color = Color(0xFFDC2626),&#10;                            fontSize = 13.sp,&#10;                            modifier = Modifier.padding(12.dp)&#10;                        )&#10;                    }&#10;                }&#10;&#10;                // Contraseña actual&#10;                OutlinedTextField(&#10;                    value = currentPassword,&#10;                    onValueChange = {&#10;                        currentPassword = it&#10;                        errorMessage = &quot;&quot;&#10;                    },&#10;                    label = { Text(&quot;Contraseña Actual&quot;) },&#10;                    visualTransformation = if (currentPasswordVisible)&#10;                        VisualTransformation.None&#10;                    else&#10;                        PasswordVisualTransformation(),&#10;                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password),&#10;                    trailingIcon = {&#10;                        IconButton(onClick = { currentPasswordVisible = !currentPasswordVisible }) {&#10;                            Icon(&#10;                                imageVector = if (currentPasswordVisible)&#10;                                    Icons.Default.Visibility&#10;                                else&#10;                                    Icons.Default.VisibilityOff,&#10;                                contentDescription = if (currentPasswordVisible)&#10;                                    &quot;Ocultar contraseña&quot;&#10;                                else&#10;                                    &quot;Mostrar contraseña&quot;&#10;                            )&#10;                        }&#10;                    },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    singleLine = true,&#10;                    colors = OutlinedTextFieldDefaults.colors(&#10;                        focusedBorderColor = primaryColor,&#10;                        focusedLabelColor = primaryColor,&#10;                        cursorColor = primaryColor&#10;                    )&#10;                )&#10;&#10;                // Nueva contraseña&#10;                OutlinedTextField(&#10;                    value = newPassword,&#10;                    onValueChange = {&#10;                        newPassword = it&#10;                        errorMessage = &quot;&quot;&#10;                    },&#10;                    label = { Text(&quot;Nueva Contraseña&quot;) },&#10;                    visualTransformation = if (newPasswordVisible)&#10;                        VisualTransformation.None&#10;                    else&#10;                        PasswordVisualTransformation(),&#10;                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password),&#10;                    trailingIcon = {&#10;                        IconButton(onClick = { newPasswordVisible = !newPasswordVisible }) {&#10;                            Icon(&#10;                                imageVector = if (newPasswordVisible)&#10;                                    Icons.Default.Visibility&#10;                                else&#10;                                    Icons.Default.VisibilityOff,&#10;                                contentDescription = if (newPasswordVisible)&#10;                                    &quot;Ocultar contraseña&quot;&#10;                                else&#10;                                    &quot;Mostrar contraseña&quot;&#10;                            )&#10;                        }&#10;                    },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    singleLine = true,&#10;                    colors = OutlinedTextFieldDefaults.colors(&#10;                        focusedBorderColor = primaryColor,&#10;                        focusedLabelColor = primaryColor,&#10;                        cursorColor = primaryColor&#10;                    )&#10;                )&#10;&#10;                // Confirmar contraseña&#10;                OutlinedTextField(&#10;                    value = confirmPassword,&#10;                    onValueChange = {&#10;                        confirmPassword = it&#10;                        errorMessage = &quot;&quot;&#10;                    },&#10;                    label = { Text(&quot;Confirmar Nueva Contraseña&quot;) },&#10;                    visualTransformation = if (confirmPasswordVisible)&#10;                        VisualTransformation.None&#10;                    else&#10;                        PasswordVisualTransformation(),&#10;                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password),&#10;                    trailingIcon = {&#10;                        IconButton(onClick = { confirmPasswordVisible = !confirmPasswordVisible }) {&#10;                            Icon(&#10;                                imageVector = if (confirmPasswordVisible)&#10;                                    Icons.Default.Visibility&#10;                                else&#10;                                    Icons.Default.VisibilityOff,&#10;                                contentDescription = if (confirmPasswordVisible)&#10;                                    &quot;Ocultar contraseña&quot;&#10;                                else&#10;                                    &quot;Mostrar contraseña&quot;&#10;                            )&#10;                        }&#10;                    },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    singleLine = true,&#10;                    colors = OutlinedTextFieldDefaults.colors(&#10;                        focusedBorderColor = primaryColor,&#10;                        focusedLabelColor = primaryColor,&#10;                        cursorColor = primaryColor&#10;                    )&#10;                )&#10;&#10;                Text(&#10;                    text = &quot;La contraseña debe tener al menos 6 caracteres&quot;,&#10;                    fontSize = 12.sp,&#10;                    color = textSecondary&#10;                )&#10;            }&#10;        },&#10;        confirmButton = {&#10;            Button(&#10;                onClick = {&#10;                    when {&#10;                        currentPassword.isEmpty() -&gt; {&#10;                            errorMessage = &quot;Ingresa tu contraseña actual&quot;&#10;                        }&#10;                        newPassword.isEmpty() -&gt; {&#10;                            errorMessage = &quot;Ingresa una nueva contraseña&quot;&#10;                        }&#10;                        newPassword.length &lt; 6 -&gt; {&#10;                            errorMessage = &quot;La contraseña debe tener al menos 6 caracteres&quot;&#10;                        }&#10;                        newPassword != confirmPassword -&gt; {&#10;                            errorMessage = &quot;Las contraseñas no coinciden&quot;&#10;                        }&#10;                        currentPassword == newPassword -&gt; {&#10;                            errorMessage = &quot;La nueva contraseña debe ser diferente a la actual&quot;&#10;                        }&#10;                        else -&gt; {&#10;                            onConfirm(currentPassword, newPassword)&#10;                        }&#10;                    }&#10;                },&#10;                colors = ButtonDefaults.buttonColors(&#10;                    containerColor = primaryColor&#10;                ),&#10;                enabled = !isLoading&#10;            ) {&#10;                if (isLoading) {&#10;                    CircularProgressIndicator(&#10;                        modifier = Modifier.size(20.dp),&#10;                        color = Color.White,&#10;                        strokeWidth = 2.dp&#10;                    )&#10;                } else {&#10;                    Text(&quot;Cambiar&quot;)&#10;                }&#10;            }&#10;        },&#10;        dismissButton = {&#10;            TextButton(&#10;                onClick = onDismiss,&#10;                colors = ButtonDefaults.textButtonColors(&#10;                    contentColor = textSecondary&#10;                )&#10;            ) {&#10;                Text(&quot;Cancelar&quot;)&#10;            }&#10;        }&#10;    )&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun PerfilScreenPreview() {&#10;    PerfilScreen(onLogout = {})&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>