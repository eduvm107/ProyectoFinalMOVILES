<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/chatbot_diseo/presentation/historial/HistorialItem.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/chatbot_diseo/presentation/historial/HistorialItem.kt" />
              <option name="originalContent" value="package com.example.chatbot_diseo.presentation.historial&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Person&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.example.chatbot_diseo.data.model.Conversacion&#10;&#10;@Composable&#10;fun HistorialItem(&#10;    chat: Conversacion,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    val colorEstado = if (chat.activa) Color(0xFF4CAF50) else Color.Gray&#10;    val textoEstado = if (chat.activa) &quot;Activo&quot; else &quot;Cerrado&quot;&#10;&#10;    // Formato simple de hora (cortamos el string de fecha)&#10;    val fechaMostrar = if(chat.fechaInicio.length &gt; 10) chat.fechaInicio.substring(0, 10) else chat.fechaInicio&#10;&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp, vertical = 6.dp)&#10;            .clickable { onClick() },&#10;        shape = RoundedCornerShape(12.dp),&#10;        colors = CardDefaults.cardColors(containerColor = Color.White),&#10;        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier.padding(16.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            // Avatar&#10;            Box(&#10;                modifier = Modifier.size(48.dp).clip(CircleShape).background(Color.LightGray.copy(0.2f)),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Icon(Icons.Default.Person, null, tint = Color.Gray)&#10;            }&#10;&#10;            Spacer(modifier = Modifier.width(16.dp))&#10;&#10;            // Info&#10;            Column(modifier = Modifier.weight(1f)) {&#10;                Text(&quot;Chat de Soporte&quot;, fontWeight = FontWeight.Bold)&#10;                Text(&quot;Fecha: $fechaMostrar&quot;, style = MaterialTheme.typography.bodySmall, color = Color.Gray)&#10;            }&#10;&#10;            // Estado&#10;            Surface(&#10;                color = colorEstado.copy(alpha = 0.1f),&#10;                shape = RoundedCornerShape(50)&#10;            ) {&#10;                Text(&#10;                    text = textoEstado,&#10;                    modifier = Modifier.padding(horizontal = 8.dp, vertical = 4.dp),&#10;                    style = MaterialTheme.typography.labelSmall,&#10;                    color = colorEstado&#10;                )&#10;            }&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.chatbot_diseo.presentation.historial&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Person&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.example.chatbot_diseo.data.model.Conversacion&#10;&#10;@Composable&#10;fun HistorialItem(&#10;    chat: Conversacion,&#10;    onClick: (conversacionId: String) -&gt; Unit&#10;) {&#10;    val colorEstado = if (chat.activa) Color(0xFF4CAF50) else Color.Gray&#10;    val textoEstado = if (chat.activa) &quot;Activo&quot; else &quot;Cerrado&quot;&#10;&#10;    // Formato simple de hora (cortamos el string de fecha)&#10;    val fechaMostrar = if(chat.fechaInicio.length &gt; 10) chat.fechaInicio.substring(0, 10) else chat.fechaInicio&#10;&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(horizontal = 16.dp, vertical = 6.dp)&#10;            .clickable { onClick(chat.id) },&#10;        shape = RoundedCornerShape(12.dp),&#10;        colors = CardDefaults.cardColors(containerColor = Color.White),&#10;        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier.padding(16.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            // Avatar&#10;            Box(&#10;                modifier = Modifier.size(48.dp).clip(CircleShape).background(Color.LightGray.copy(0.2f)),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Icon(Icons.Default.Person, null, tint = Color.Gray)&#10;            }&#10;&#10;            Spacer(modifier = Modifier.width(16.dp))&#10;&#10;            // Info&#10;            Column(modifier = Modifier.weight(1f)) {&#10;                Text(&quot;Chat de Soporte&quot;, fontWeight = FontWeight.Bold)&#10;                Text(&quot;Fecha: $fechaMostrar&quot;, style = MaterialTheme.typography.bodySmall, color = Color.Gray)&#10;            }&#10;&#10;            // Estado&#10;            Surface(&#10;                color = colorEstado.copy(alpha = 0.1f),&#10;                shape = RoundedCornerShape(50)&#10;            ) {&#10;                Text(&#10;                    text = textoEstado,&#10;                    modifier = Modifier.padding(horizontal = 8.dp, vertical = 4.dp),&#10;                    style = MaterialTheme.typography.labelSmall,&#10;                    color = colorEstado&#10;                )&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/chatbot_diseo/presentation/historial/HistorialScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/chatbot_diseo/presentation/historial/HistorialScreen.kt" />
              <option name="originalContent" value="package com.example.chatbot_diseo.presentation.historial&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Edit&#10;import androidx.compose.material.icons.outlined.ArrowBack&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.unit.dp&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HistorialScreen(&#10;    onBack: () -&gt; Unit,&#10;    viewModel: HistorialViewModel = viewModel()&#10;) {&#10;    val chats by viewModel.chats.collectAsState()&#10;&#10;    Scaffold(&#10;        topBar = {&#10;            TopAppBar(&#10;                title = { Text(&quot;Mis Conversaciones&quot;) },&#10;                navigationIcon = {&#10;                    IconButton(onClick = onBack) { Icon(Icons.Outlined.ArrowBack, null) }&#10;                },&#10;                colors = TopAppBarDefaults.topAppBarColors(containerColor = Color.White)&#10;            )&#10;        },&#10;        floatingActionButton = {&#10;            FloatingActionButton(&#10;                onClick = { viewModel.crearNuevoChat() }, // Crea chat en Mongo&#10;                containerColor = Color(0xFF1A73E8),&#10;                contentColor = Color.White&#10;            ) {&#10;                Icon(Icons.Default.Edit, &quot;Nuevo Chat&quot;)&#10;            }&#10;        },&#10;        containerColor = Color(0xFFF8F9FA)&#10;    ) { padding -&gt;&#10;        if (chats.isEmpty()) {&#10;            Box(Modifier.fillMaxSize().padding(padding), contentAlignment = Alignment.Center) {&#10;                Text(&quot;No hay chats recientes&quot;, color = Color.Gray)&#10;            }&#10;        } else {&#10;            LazyColumn(&#10;                modifier = Modifier.padding(padding).fillMaxSize(),&#10;                contentPadding = PaddingValues(top = 10.dp, bottom = 80.dp)&#10;            ) {&#10;                items(chats) { chat -&gt;&#10;                    HistorialItem(chat = chat, onClick = { /* Navegar al chat luego */ })&#10;                }&#10;            }&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.chatbot_diseo.presentation.historial&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Edit&#10;import androidx.compose.material.icons.outlined.ArrowBack&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.unit.dp&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import com.example.chatbot_diseo.data.repository.HistorialRepository&#10;import kotlinx.coroutines.flow.collectLatest&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HistorialScreen(&#10;    usuarioId: String,&#10;    onBack: () -&gt; Unit,&#10;    onOpenChat: (conversacionId: String) -&gt; Unit,&#10;    viewModel: HistorialViewModel = viewModel(factory = HistorialViewModelFactory(HistorialRepository(), usuarioId))&#10;) {&#10;    val chats by viewModel.chats.collectAsState()&#10;&#10;    val snackbarHostState = remember { SnackbarHostState() }&#10;&#10;    // Observamos uiEvent y mostramos Snackbar cuando haya mensaje&#10;    val uiEvent by remember { viewModel.uiEvent }.collectAsState(initial = null)&#10;&#10;    LaunchedEffect(uiEvent) {&#10;        uiEvent?.let { msg -&gt;&#10;            snackbarHostState.showSnackbar(msg)&#10;            viewModel.uiEventConsumed()&#10;        }&#10;    }&#10;&#10;    Scaffold(&#10;        topBar = {&#10;            TopAppBar(&#10;                title = { Text(&quot;Mis Conversaciones&quot;) },&#10;                navigationIcon = {&#10;                    IconButton(onClick = onBack) { Icon(Icons.Outlined.ArrowBack, null) }&#10;                },&#10;                colors = TopAppBarDefaults.topAppBarColors(containerColor = Color.White)&#10;            )&#10;        },&#10;        snackbarHost = { SnackbarHost(hostState = snackbarHostState) },&#10;        floatingActionButton = {&#10;            FloatingActionButton(&#10;                onClick = { viewModel.crearNuevoChat() }, // Crea chat en Mongo&#10;                containerColor = Color(0xFF1A73E8),&#10;                contentColor = Color.White&#10;            ) {&#10;                Icon(Icons.Default.Edit, &quot;Nuevo Chat&quot;)&#10;            }&#10;        },&#10;        containerColor = Color(0xFFF8F9FA)&#10;    ) { padding -&gt;&#10;        if (chats.isEmpty()) {&#10;            Box(Modifier.fillMaxSize().padding(padding), contentAlignment = Alignment.Center) {&#10;                Text(&quot;No hay chats recientes&quot;, color = Color.Gray)&#10;            }&#10;        } else {&#10;            LazyColumn(&#10;                modifier = Modifier.padding(padding).fillMaxSize(),&#10;                contentPadding = PaddingValues(top = 10.dp, bottom = 80.dp)&#10;            ) {&#10;                items(chats) { chat -&gt;&#10;                    // Pasamos el id de la conversación al hacer click&#10;                    HistorialItem(chat = chat, onClick = { onOpenChat(chat.id) })&#10;                }&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/chatbot_diseo/presentation/navigation/AppNavGraph.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/chatbot_diseo/presentation/navigation/AppNavGraph.kt" />
              <option name="originalContent" value="package com.example.chatbot_diseo.presentation.navigation&#10;&#10;import android.widget.Toast&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.navigation.NavHostController&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.navArgument&#10;import androidx.navigation.NavType&#10;import com.example.chatbot_diseo.data.api.TokenHolder&#10;import com.example.chatbot_diseo.presentation.admin.page.AdminPanelScreen&#10;import com.example.chatbot_diseo.presentation.auth.ForgotPasswordScreen&#10;import com.example.chatbot_diseo.presentation.auth.LoginScreen&#10;import com.example.chatbot_diseo.presentation.ayuda.AyudaScreen&#10;import com.example.chatbot_diseo.presentation.calendario.Pantalla_Calendario&#10;import com.example.chatbot_diseo.presentation.chat.ChatScreen&#10;import com.example.chatbot_diseo.presentation.favoritos.FavoritosScreen&#10;import com.example.chatbot_diseo.presentation.historial.HistorialScreen&#10;import com.example.chatbot_diseo.presentation.notificaciones.NotificacionesScreen&#10;import com.example.chatbot_diseo.presentation.recursos.Pantalla_de_Recurso&#10;import com.example.chatbot_diseo.presentation.userperfil.PerfilScreen&#10;import com.example.chatbot_diseo.presentation.theme.ThemeViewModel&#10;&#10;@Composable&#10;fun AppNavGraph(&#10;    modifier: Modifier = Modifier,&#10;    navController: NavHostController,&#10;    themeViewModel: ThemeViewModel? = null&#10;) {&#10;    val context = LocalContext.current&#10;&#10;    NavHost(&#10;        navController = navController,&#10;        startDestination = &quot;login&quot;,&#10;        modifier = modifier&#10;    ) {&#10;        // Pantalla de Login&#10;        composable(&quot;login&quot;) {&#10;            LoginScreen(&#10;                onLogin = { role -&gt;&#10;                    // Verificar token guardado antes de navegar&#10;                    val token = TokenHolder.token&#10;                    if (token.isNullOrBlank()) {&#10;                        Toast.makeText(context, &quot;Login inválido (sin token)&quot;, Toast.LENGTH_SHORT).show()&#10;                        return@LoginScreen&#10;                    }&#10;                    Toast.makeText(context, &quot;Bienvenido! Rol: $role&quot;, Toast.LENGTH_SHORT).show()&#10;&#10;                    // Redirigir según el rol&#10;                    val destination = if (role == &quot;admin&quot;) &quot;admin_panel&quot; else &quot;chat&quot;&#10;&#10;                    navController.navigate(destination) {&#10;                        popUpTo(&quot;login&quot;) { inclusive = true }&#10;                    }&#10;                },&#10;                onForgotPassword = {&#10;                    navController.navigate(&quot;forgot_password&quot;)&#10;                }&#10;            )&#10;        }&#10;&#10;        // Pantalla de Recuperar Contraseña&#10;        composable(&quot;forgot_password&quot;) {&#10;            ForgotPasswordScreen(&#10;                onBack = {&#10;                    navController.popBackStack()&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;admin_panel&quot;) {&#10;            AdminPanelScreen(&#10;                onBack = { navController.popBackStack() },&#10;                onLogout = {&#10;                    // Limpiar token e ID del usuario&#10;                    TokenHolder.clear()&#10;                    navController.navigate(&quot;login&quot;) {&#10;                        popUpTo(0) { inclusive = true }&#10;                    }&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;chat&quot;) {&#10;            ChatScreen(navController = navController)&#10;        }&#10;&#10;        composable(&quot;calendario&quot;) {&#10;            Pantalla_Calendario()&#10;        }&#10;&#10;        composable(&quot;recursos&quot;) {&#10;            Pantalla_de_Recurso()&#10;        }&#10;&#10;        composable(&quot;perfil&quot;) {&#10;            val isDarkTheme by themeViewModel?.isDarkTheme?.collectAsState() ?: remember { mutableStateOf(false) }&#10;            PerfilScreen(&#10;                onLogout = {&#10;                    // Limpiar token e ID del usuario&#10;                    TokenHolder.clear()&#10;                    navController.navigate(&quot;login&quot;) {&#10;                        popUpTo(0) { inclusive = true }&#10;                    }&#10;                },&#10;                isDarkTheme = isDarkTheme,&#10;                onThemeToggle = { newValue -&gt;&#10;                    themeViewModel?.setDarkTheme(newValue)&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;notificaciones&quot;) {&#10;            NotificacionesScreen(onBack = { navController.popBackStack() })&#10;        }&#10;&#10;        // Historial: pasamos usuarioId desde TokenHolder&#10;        composable(&quot;historial&quot;) {&#10;            val usuarioId = TokenHolder.usuarioId ?: &quot;&quot;&#10;            HistorialScreen(&#10;                usuarioId = usuarioId,&#10;                onBack = { navController.popBackStack() },&#10;                onOpenChat = { conversacionId -&gt;&#10;                    // Navegar a chat con el id de conversacion&#10;                    navController.navigate(&quot;chat/$conversacionId&quot;) {&#10;                        launchSingleTop = true&#10;                        restoreState = true&#10;                    }&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;favoritos&quot;) {&#10;            FavoritosScreen(onBack = { navController.popBackStack() })&#10;        }&#10;&#10;        composable(&quot;ayuda&quot;) {&#10;            AyudaScreen(onBack = { navController.popBackStack() })&#10;        }&#10;&#10;        // Ruta para abrir chat con una conversacionId opcional&#10;        composable(&#10;            route = &quot;chat/{conversacionId}&quot;,&#10;            arguments = listOf(navArgument(&quot;conversacionId&quot;) { type = NavType.StringType })&#10;        ) { backStackEntry -&gt;&#10;            val convId = backStackEntry.arguments?.getString(&quot;conversacionId&quot;)&#10;            ChatScreen(navController = navController, initialConversacionId = convId)&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.chatbot_diseo.presentation.navigation&#10;&#10;import android.widget.Toast&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.navigation.NavHostController&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.navArgument&#10;import androidx.navigation.NavType&#10;import com.example.chatbot_diseo.data.api.TokenHolder&#10;import com.example.chatbot_diseo.presentation.admin.page.AdminPanelScreen&#10;import com.example.chatbot_diseo.presentation.auth.ForgotPasswordScreen&#10;import com.example.chatbot_diseo.presentation.auth.LoginScreen&#10;import com.example.chatbot_diseo.presentation.ayuda.AyudaScreen&#10;import com.example.chatbot_diseo.presentation.calendario.Pantalla_Calendario&#10;import com.example.chatbot_diseo.presentation.chat.ChatScreen&#10;import com.example.chatbot_diseo.presentation.favoritos.FavoritosScreen&#10;import com.example.chatbot_diseo.presentation.historial.HistorialScreen&#10;import com.example.chatbot_diseo.presentation.notificaciones.NotificacionesScreen&#10;import com.example.chatbot_diseo.presentation.recursos.Pantalla_de_Recurso&#10;import com.example.chatbot_diseo.presentation.userperfil.PerfilScreen&#10;import com.example.chatbot_diseo.presentation.theme.ThemeViewModel&#10;&#10;@Composable&#10;fun AppNavGraph(&#10;    modifier: Modifier = Modifier,&#10;    navController: NavHostController,&#10;    themeViewModel: ThemeViewModel? = null&#10;) {&#10;    val context = LocalContext.current&#10;&#10;    NavHost(&#10;        navController = navController,&#10;        startDestination = &quot;login&quot;,&#10;        modifier = modifier&#10;    ) {&#10;        // Pantalla de Login&#10;        composable(&quot;login&quot;) {&#10;            LoginScreen(&#10;                onLogin = { role -&gt;&#10;                    // Verificar token guardado antes de navegar&#10;                    val token = TokenHolder.token&#10;                    if (token.isNullOrBlank()) {&#10;                        Toast.makeText(context, &quot;Login inválido (sin token)&quot;, Toast.LENGTH_SHORT).show()&#10;                        return@LoginScreen&#10;                    }&#10;                    Toast.makeText(context, &quot;Bienvenido! Rol: $role&quot;, Toast.LENGTH_SHORT).show()&#10;&#10;                    // Redirigir según el rol&#10;                    val destination = if (role == &quot;admin&quot;) &quot;admin_panel&quot; else &quot;chat&quot;&#10;&#10;                    navController.navigate(destination) {&#10;                        popUpTo(&quot;login&quot;) { inclusive = true }&#10;                    }&#10;                },&#10;                onForgotPassword = {&#10;                    navController.navigate(&quot;forgot_password&quot;)&#10;                }&#10;            )&#10;        }&#10;&#10;        // Pantalla de Recuperar Contraseña&#10;        composable(&quot;forgot_password&quot;) {&#10;            ForgotPasswordScreen(&#10;                onBack = {&#10;                    navController.popBackStack()&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;admin_panel&quot;) {&#10;            AdminPanelScreen(&#10;                onBack = { navController.popBackStack() },&#10;                onLogout = {&#10;                    // Limpiar token e ID del usuario&#10;                    TokenHolder.clear()&#10;                    navController.navigate(&quot;login&quot;) {&#10;                        popUpTo(0) { inclusive = true }&#10;                    }&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;chat&quot;) {&#10;            ChatScreen(navController = navController)&#10;        }&#10;&#10;        composable(&quot;calendario&quot;) {&#10;            Pantalla_Calendario()&#10;        }&#10;&#10;        composable(&quot;recursos&quot;) {&#10;            Pantalla_de_Recurso()&#10;        }&#10;&#10;        composable(&quot;perfil&quot;) {&#10;            val isDarkTheme by themeViewModel?.isDarkTheme?.collectAsState() ?: remember { mutableStateOf(false) }&#10;            PerfilScreen(&#10;                onLogout = {&#10;                    // Limpiar token e ID del usuario&#10;                    TokenHolder.clear()&#10;                    navController.navigate(&quot;login&quot;) {&#10;                        popUpTo(0) { inclusive = true }&#10;                    }&#10;                },&#10;                isDarkTheme = isDarkTheme,&#10;                onThemeToggle = { newValue -&gt;&#10;                    themeViewModel?.setDarkTheme(newValue)&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;notificaciones&quot;) {&#10;            NotificacionesScreen(onBack = { navController.popBackStack() })&#10;        }&#10;&#10;        // Historial: pasamos usuarioId desde TokenHolder&#10;        composable(&quot;historial&quot;) {&#10;            val usuarioId = TokenHolder.usuarioId ?: &quot;&quot;&#10;            HistorialScreen(&#10;                usuarioId = usuarioId,&#10;                onBack = { navController.popBackStack() },&#10;                onOpenChat = { conversacionId -&gt;&#10;                    // Navegar a chat con el id de conversacion&#10;                    navController.navigate(&quot;chat/$conversacionId&quot;) {&#10;                        launchSingleTop = true&#10;                        restoreState = true&#10;                    }&#10;                }&#10;            )&#10;        }&#10;&#10;        composable(&quot;favoritos&quot;) {&#10;            FavoritosScreen(onBack = { navController.popBackStack() })&#10;        }&#10;&#10;        composable(&quot;ayuda&quot;) {&#10;            AyudaScreen(onBack = { navController.popBackStack() })&#10;        }&#10;&#10;        // Ruta para abrir chat con una conversacionId opcional&#10;        composable(&#10;            route = &quot;chat/{conversacionId}&quot;,&#10;            arguments = listOf(navArgument(&quot;conversacionId&quot;) { type = NavType.StringType })&#10;        ) { backStackEntry -&gt;&#10;            val convId = backStackEntry.arguments?.getString(&quot;conversacionId&quot;)&#10;            // usar llamada posicional para evitar problemas con nombres de parámetros&#10;            ChatScreen(navController, convId)&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>